# План разработки Bot Constructor

⚠️ **АВТОРИЗАЦИЯ ПОЛНОСТЬЮ УДАЛЕНА**  
В планах разработки НЕТ и НЕ БУДЕТ пунктов по авторизации!

## Этап 1: Исправление админки (ПРИОРИТЕТ 1) ✅ ЗАВЕРШЕН

### 1.1 Полное удаление авторизации ✅
- [x] Убрать авторизацию через Telegram из index.html
- [x] Сделать прямой доступ к админ-панели  
- [x] Удалить ненужные элементы авторизации
- [x] **УДАЛИТЬ ВСЕ ФАЙЛЫ АВТОРИЗАЦИИ**
- [x] **СОЗДАТЬ ПОЛИТИКУ ЗАПРЕТА АВТОРИЗАЦИИ**

### 1.2 Очистка от подписок
- [x] Удалить routes/subscription.js
- [x] Удалить middleware/subscription.js  
- [x] Удалить utils/SubscriptionManager.js
- [x] Удалить public/subscription.html
- [x] Убрать ссылки на подписки из server.js

### 1.3 Проверка навигации
- [x] Проверить переключение между разделами (Боты, Редактор, Шаблоны, Статистика)
- [x] Исправить работу кнопок и ссылок
- [x] Убедиться что все разделы отображаются

### 1.4 Базовая функциональность
- [x] Убрать авторизацию из API маршрутов (routes/bots.js, routes/templates.js)
- [x] Проверить загрузку списка ботов
- [x] Проверить загрузку шаблонов
- [ ] Проверить отображение статистики

## Этап 2: Полноценный визуальный редактор

### 2.1 Анализ существующих компонентов
- [x] Изучить public/js/VisualEditor.js
- [x] Изучить public/js/NodeLibrary.js
- [x] Изучить public/js/PropertyPanel.js
- [x] Определить что работает, что нужно доработать

### 2.2 Интеграция в админку
- [x] Подключить визуальный редактор к разделу "Редактор"
- [x] Подключить JS файлы к index.html
- [x] Настроить инициализацию компонентов
- [ ] Тестировать drag & drop узлов
- [ ] Проверить соединения между узлами (линии/стрелки)

### 2.3 Панель свойств
- [x] Интегрировать PropertyPanel
- [x] Настройка событий для выбора узлов
- [ ] Тестировать настройку свойств узлов
- [ ] Проверить валидацию настроек узлов

### 2.4 Сохранение/загрузка схем
- [x] Реализовать сохранение схемы бота в JSON
- [x] Реализовать загрузку схемы для редактирования
- [x] Добавить методы тестирования ботов
- [ ] Тестировать экспорт/импорт схем

## Этап 3: Поддержка мессенджеров

### 3.1 Изучение MAX API
- [x] Изучить документацию https://dev.max.ru/docs (базовое понимание)
- [x] Понять принципы работы с MAX ботами
- [x] Определить необходимые изменения в архитектуре

### 3.2 Рефакторинг BotRuntime
- [x] Создать базовый класс MessengerAdapter
- [x] Создать TelegramAdapter
- [x] Создать заглушку MaxAdapter
- [x] Создать MessengerAdapterFactory
- [x] Начать рефакторинг BotRuntime
- [x] Обновить методы loadBot и processMessage
- [x] Добавить выбор мессенджера в админку
- [x] Обновить API для поддержки разных мессенджеров

### 3.3 Интеграция MAX
- [x] Создать базовую структуру MAX адаптера
- [x] Доработать MAX адаптер по официальной документации
- [x] Обновить API endpoints согласно MAX Bot API
- [x] Добавить валидацию MAX токенов
- [x] Обновить формат токенов и поддерживаемые функции
- [ ] Тестирование работы с MAX

## Этап 4: Развертывание и управление

### 4.1 Управление ботами
- [x] Подключение бота к выбранному мессенджеру
- [x] Проверка валидности токенов
- [x] Запуск/остановка ботов через админку
- [x] Отображение информации о ботах

### 4.2 Мониторинг
- [x] Отображение статуса ботов с типом мессенджера
- [x] Статистика работы ботов (время работы, сообщения, ошибки)
- [x] Обновленная система мониторинга через адаптеры
- [ ] Детальные логи работы ботов

## Этап 5: Типы узлов и логика

### 5.1 Базовые узлы
- [ ] Узел "Отправить сообщение"
- [ ] Узел "Получить ответ пользователя"
- [ ] Узел "Условие" (if/else)
- [ ] Узел "Задержка"

### 5.2 Продвинутые узлы
- [ ] Узел "Сохранить данные"
- [ ] Узел "HTTP запрос"
- [ ] Узел "Случайный выбор"
- [ ] Узел "Цикл"

### 5.3 Выполнение логики
- [ ] Интерпретатор схемы узлов
- [ ] Выполнение последовательности узлов
- [ ] Обработка условий и переходов

## Этап 6: Оптимизация и улучшения

### 6.1 UI/UX
- [ ] Улучшение интерфейса редактора
- [ ] Добавление горячих клавиш
- [ ] Улучшение отзывчивости

### 6.2 Производительность
- [ ] Оптимизация рендеринга canvas
- [ ] Кэширование данных
- [ ] Уменьшение размера файлов

## Этап 7: Финализация проекта (ПОСЛЕДНИЙ)

### 7.1 Единая точка входа
- [ ] Создать главный исполняемый файл (main.js или app.js)
- [ ] Объединить все компоненты в единую систему
- [ ] Упростить структуру запуска

### 7.2 Улучшение bat-файла
- [ ] Сделать bat-файл более надежным
- [ ] Добавить проверки зависимостей
- [ ] Улучшить обработку ошибок
- [ ] Добавить автоматическую установку зависимостей

### 7.3 Документация и финальная настройка
- [ ] Создать README с инструкциями по запуску
- [ ] Добавить примеры использования
- [ ] Финальное тестирование всей системы
- [ ] Подготовка к продакшену

---

## Текущий статус: Этап 2 - Полноценный визуальный редактор (завершен)

**Следующая задача:** Этап 3 - Поддержка мессенджеров

**Правила выполнения:**
- Выполняем задачи последовательно
- Каждую задачу помечаем как выполненную
- Обсуждаем изменения перед реализацией сложных функций
- Тестируем каждый этап перед переходом к следующему
- Bat-файл и единая точка входа - ПОСЛЕДНИЙ этап