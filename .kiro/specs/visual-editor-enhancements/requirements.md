# Документ требований - Визуальный редактор и улучшения

## Введение

Данная спецификация описывает улучшения для конструктора ботов, включающие визуальный редактор с drag-and-drop интерфейсом, расширенный набор узлов, защиту от дублирования токенов и улучшенное извлечение данных ботов из сообщений BotFather.

## Требования

### Требование 1

**Пользовательская история:** Как пользователь, я хочу создавать ботов через визуальный редактор с drag-and-drop интерфейсом, чтобы интуитивно строить логику бота без написания кода.

#### Критерии приемки

1. КОГДА пользователь открывает редактор бота, ТОГДА система ДОЛЖНА отображать холст для размещения узлов и панель с доступными типами узлов
2. КОГДА пользователь перетаскивает узел на холст, ТОГДА система ДОЛЖНА создать визуальный блок с возможностью настройки параметров
3. КОГДА пользователь соединяет два узла, ТОГДА система ДОЛЖНА создать визуальную связь и логическое соединение в структуре бота
4. ЕСЛИ пользователь пытается создать некорректное соединение, ТОГДА система ДОЛЖНА показать предупреждение и не позволить создать связь
5. КОГДА пользователь сохраняет схему, ТОГДА система ДОЛЖНА конвертировать визуальную схему в JSON-структуру бота

### Требование 2

**Пользовательская история:** Как создатель бота, я хочу использовать расширенный набор узлов для создания сложной логики, чтобы покрыть больше сценариев использования.

#### Критерии приемки

1. КОГДА пользователь открывает панель узлов, ТОГДА система ДОЛЖНА отображать категории: Триггеры, Условия, Действия, Данные, Интеграции
2. КОГДА пользователь выбирает категорию "Триггеры", ТОГДА система ДОЛЖНА показать узлы: Команда, Текст, Callback, Inline-запрос, Присоединение к группе, Покидание группы
3. КОГДА пользователь выбирает категорию "Условия", ТОГДА система ДОЛЖНА показать узлы: Проверка текста, Проверка пользователя, Проверка времени, Проверка данных, Логические операторы (И, ИЛИ, НЕ)
4. КОГДА пользователь выбирает категорию "Действия", ТОГДА система ДОЛЖНА показать узлы: Отправить сообщение, Отправить фото, Создать клавиатуру, Изменить права, Забанить/разбанить, Задержка
5. КОГДА пользователь выбирает категорию "Данные", ТОГДА система ДОЛЖНА показать узлы: Сохранить переменную, Загрузить переменную, Счетчик, База данных, Случайное число
6. КОГДА пользователь выбирает категорию "Интеграции", ТОГДА система ДОЛЖНА показать узлы: HTTP-запрос, Webhook, Планировщик, Уведомления

### Требование 3

**Пользовательская история:** Как администратор платформы, я хочу предотвратить использование одинаковых токенов ботов разными пользователями, чтобы избежать конфликтов и обеспечить безопасность.

#### Критерии приемки

1. КОГДА пользователь вводит токен бота, ТОГДА система ДОЛЖНА проверить уникальность токена в базе данных
2. ЕСЛИ токен уже используется другим пользователем, ТОГДА система ДОЛЖНА показать ошибку "Этот токен уже используется другим ботом"
3. КОГДА пользователь сохраняет бота с новым токеном, ТОГДА система ДОЛЖНА добавить токен в список используемых
4. ЕСЛИ пользователь удаляет бота, ТОГДА система ДОЛЖНА освободить токен для повторного использования
5. КОГДА администратор просматривает список ботов, ТОГДА система ДОЛЖНА показывать статус токенов (активный, неактивный, дублированный)

### Требование 4

**Пользовательская история:** Как пользователь, я хочу автоматически получать информацию о боте из сообщения BotFather, чтобы не вводить данные вручную.

#### Критерии приемки

1. КОГДА пользователь вставляет сообщение от BotFather, ТОГДА система ДОЛЖНА автоматически извлечь токен API, имя бота и username
2. КОГДА система извлекает данные, ТОГДА она ДОЛЖНА автоматически заполнить соответствующие поля в форме создания бота
3. ЕСЛИ сообщение не содержит корректных данных BotFather, ТОГДА система ДОЛЖНА показать ошибку "Некорректное сообщение от BotFather"
4. КОГДА данные извлечены успешно, ТОГДА система ДОЛЖНА отобразить карточку бота с именем, username и статусом токена
5. ЕСЛИ извлеченный токен уже используется, ТОГДА система ДОЛЖНА показать предупреждение перед заполнением формы

### Требование 5

**Пользовательская история:** Как пользователь, я хочу видеть улучшенные карточки ботов с полной информацией, чтобы легко управлять своими ботами.

#### Критерии приемки

1. КОГДА пользователь просматривает список ботов, ТОГДА система ДОЛЖНА отображать карточки с именем бота, username, статусом и последней активностью
2. КОГДА бот активен, ТОГДА карточка ДОЛЖНА показывать зеленый индикатор статуса и время последнего сообщения
3. ЕСЛИ бот неактивен или имеет ошибки, ТОГДА карточка ДОЛЖНА показывать красный индикатор и описание проблемы
4. КОГДА пользователь наводит курсор на карточку, ТОГДА система ДОЛЖНА показать дополнительную информацию: количество узлов, дата создания, статистика использования
5. КОГДА пользователь кликает на карточку, ТОГДА система ДОЛЖНА открыть визуальный редактор с загруженной схемой бота