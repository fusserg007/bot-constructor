# Requirements Document

## Introduction

Визуальный редактор ботов нуждается в кардинальном улучшении архитектуры для повышения удобства использования и упрощения разработки. Необходимо реализовать модульную архитектуру с мульти-узлами, умной витриной компонентов, системой логирования и упрощенной навигацией.

## Requirements

### Requirement 1

**User Story:** Как разработчик бота, я хочу использовать мульти-узлы с возможностью расширения, чтобы создавать сложные сценарии в одном блоке

#### Acceptance Criteria

1. WHEN пользователь создает узел THEN узел должен иметь треугольную кнопку расширения
2. WHEN пользователь нажимает на треугольник THEN узел должен раскрываться, показывая внутренние элементы
3. WHEN узел раскрыт THEN пользователь должен иметь возможность добавлять компоненты внутрь узла
4. WHEN пользователь сворачивает узел THEN все внутренние элементы должны скрываться, но сохраняться

### Requirement 2

**User Story:** Как пользователь системы, я хочу видеть витрину компонентов, отсортированную по частоте использования, чтобы быстро находить нужные элементы

#### Acceptance Criteria

1. WHEN пользователь открывает витрину компонентов THEN компоненты должны быть отсортированы по популярности
2. WHEN отображается витрина THEN должны быть видны три категории: "Часто используемые", "Средне используемые", "Редко используемые"
3. WHEN пользователь перетаскивает компонент THEN система должна учитывать это для обновления статистики
4. WHEN система анализирует использование THEN статистика должна обновляться автоматически

### Requirement 3

**User Story:** Как разработчик системы, я хочу иметь подробное логирование всех действий на канвасе, чтобы быстро находить и исправлять ошибки

#### Acceptance Criteria

1. WHEN происходит любое действие на канвасе THEN оно должно записываться в лог-файл
2. WHEN система запускается THEN лог-файл должен очищаться от предыдущих записей
3. WHEN записывается лог THEN должны фиксироваться: время, тип действия, детали операции
4. WHEN происходит ошибка THEN в логе должна быть подробная информация для отладки

### Requirement 4

**User Story:** Как пользователь системы, я хочу использовать двунаправленную навигацию между узлами, чтобы легко перемещаться по схеме в обе стороны

#### Acceptance Criteria

1. WHEN пользователь создает связь между узлами THEN должна отображаться двунаправленная стрелка
2. WHEN пользователь нажимает на стрелку THEN должна быть возможность навигации в обе стороны
3. WHEN отображаются связи THEN должно быть визуально понятно, что навигация двунаправленная
4. WHEN пользователь перемещается по связям THEN система должна подсвечивать текущий путь

### Requirement 5

**User Story:** Как разработчик системы, я хочу иметь модульную архитектуру редактора, чтобы легко находить и исправлять ошибки в конкретных компонентах

#### Acceptance Criteria

1. WHEN разрабатывается функциональность THEN каждый модуль должен быть в отдельной папке
2. WHEN возникает ошибка THEN должно быть понятно, в каком модуле она произошла
3. WHEN добавляется новая функция THEN она должна быть изолирована в своем модуле
4. WHEN тестируется система THEN каждый модуль должен иметь независимые тесты

### Requirement 6

**User Story:** Как пользователь системы, я хочу видеть индикацию портов подключения на узлах, чтобы понимать, где можно создавать связи

#### Acceptance Criteria

1. WHEN отображается узел THEN должны быть видны порты для входящих и исходящих связей
2. WHEN порт доступен для подключения THEN он должен подсвечиваться синим цветом
3. WHEN порт занят или недоступен THEN он должен отображаться красным цветом
4. WHEN пользователь наводит курсор на порт THEN должна показываться подсказка о его назначении

### Requirement 7

**User Story:** Как пользователь системы, я хочу иметь возможность группировки узлов по цветным зонам, чтобы визуально организовывать сложные схемы

#### Acceptance Criteria

1. WHEN пользователь выделяет несколько узлов THEN должна быть возможность создать цветную группу
2. WHEN создается группа THEN пользователь должен иметь возможность выбрать цвет зоны
3. WHEN группа создана THEN все узлы в группе должны иметь цветную рамку или фон
4. WHEN пользователь перемещает группу THEN все узлы в группе должны перемещаться вместе

### Requirement 8

**User Story:** Как пользователь системы, я хочу иметь складные группы узлов, чтобы скрывать детали реализации и фокусироваться на общей логике

#### Acceptance Criteria

1. WHEN создается группа узлов THEN должна быть кнопка сворачивания группы
2. WHEN группа сворачивается THEN все узлы внутри должны скрываться
3. WHEN группа свернута THEN должен отображаться компактный блок с названием группы
4. WHEN группа разворачивается THEN все узлы должны возвращаться в исходные позиции

### Requirement 9

**User Story:** Как пользователь системы, я хочу видеть валидацию схемы с цветными рамками, чтобы быстро находить ошибки в конфигурации

#### Acceptance Criteria

1. WHEN схема содержит ошибки THEN проблемные узлы должны выделяться красной рамкой
2. WHEN узел настроен корректно THEN он должен иметь зеленую рамку или нейтральный вид
3. WHEN есть предупреждения THEN узлы должны выделяться желтой рамкой
4. WHEN пользователь наводит курсор на проблемный узел THEN должно показываться описание ошибки

### Requirement 10

**User Story:** Как пользователь системы, я хочу видеть разные типы стрелок для разных типов связей, чтобы понимать логику взаимодействия узлов

#### Acceptance Criteria

1. WHEN создается обычная связь THEN должна отображаться простая стрелка
2. WHEN создается условная связь THEN должна отображаться стрелка с ромбом
3. WHEN создается связь с ошибкой THEN должна отображаться пунктирная красная стрелка
4. WHEN создается двунаправленная связь THEN должна отображаться стрелка с наконечниками с обеих сторон

### Requirement 11

**User Story:** Как пользователь системы, я хочу видеть подписи на стрелках связей, чтобы понимать условия перехода между узлами

#### Acceptance Criteria

1. WHEN создается связь с условием THEN на стрелке должна отображаться подпись условия
2. WHEN подпись длинная THEN она должна сокращаться с многоточием
3. WHEN пользователь наводит курсор на подпись THEN должен показываться полный текст
4. WHEN редактируется связь THEN должна быть возможность изменить подпись

### Requirement 12

**User Story:** Как пользователь системы, я хочу иметь три варианта расположения кнопок в узлах, чтобы оптимально организовать интерфейс

#### Acceptance Criteria

1. WHEN настраивается узел THEN должна быть возможность выбрать расположение кнопок: сверху, снизу или сбоку
2. WHEN выбрано расположение сверху THEN кнопки должны отображаться в верхней части узла
3. WHEN выбрано расположение снизу THEN кнопки должны отображаться в нижней части узла
4. WHEN выбрано расположение сбоку THEN кнопки должны отображаться справа от содержимого узла

### Requirement 13

**User Story:** Как пользователь системы, я хочу видеть одинаковые узлы в витрине и на канвасе, чтобы не было путаницы между тем, что я выбираю и что получаю

#### Acceptance Criteria

1. WHEN пользователь видит узел в витрине THEN этот же узел должен появляться на канвасе при добавлении
2. WHEN узел отображается в витрине THEN его иконка, название и описание должны точно соответствовать узлу на канвасе
3. WHEN пользователь перетаскивает узел из витрины THEN на канвасе должен появиться узел с идентичным внешним видом
4. WHEN обновляется дизайн узла THEN изменения должны синхронно отражаться и в витрине, и на канвасе