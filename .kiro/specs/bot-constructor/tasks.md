# План реализации

- [ ] 1. Настройка базовой инфраструктуры проекта




  - Создать структуру проекта Node.js с Express сервером
  - Настроить статическую раздачу файлов для фронтенда
  - Создать базовую файловую структуру для хранения данных (/data/users, /bots, /templates, /logs)



  - Настроить основные middleware (cors, body-parser, error handling)
  - _Требования: 6.1, 6.2_

- [x] 2. Реализация системы аутентификации через Telegram



  - Создать Telegram Login Widget для авторизации пользователей
  - Реализовать проверку подлинности данных от Telegram
  - Создать систему сессий с использованием JWT токенов
  - Реализовать middleware для проверки авторизации
  - _Требования: 7.1_



- [x] 3. Создание файловой системы хранения данных

















  - Реализовать класс FileStorage для работы с JSON файлами
  - Создать методы для чтения/записи пользователей (users/user_telegramId.json)
  - Создать методы для работы с ботами (bots/bot_uuid.json)
  - Реализовать систему блокировок файлов для предотвращения конфликтов
  - Добавить валидацию структуры данных при чтении файлов
  - _Требования: 5.1, 5.2_

- [x] 4. Разработка API для управления ботами

  - Создать REST endpoints для CRUD операций с ботами
  - Реализовать GET /api/bots - получение списка ботов пользователя
  - Реализовать POST /api/bots - создание нового бота
  - Реализовать PUT /api/bots/:id - обновление конфигурации бота
  - Реализовать DELETE /api/bots/:id - удаление бота
  - Добавить валидацию входных данных и обработку ошибок
  - _Требования: 3.1, 3.2, 3.3, 3.4_



- [x] 5. Создание системы шаблонов ботов




















  - Создать предустановленные шаблоны для каждой категории (модерация, магазин, опросы)
  - Реализовать API endpoint GET /api/templates для получения списка шаблонов
  - Реализовать POST /api/templates/:id/apply для применения шаблона к боту
  - Создать шаблоны для категорий: Бизнес, Образование, Сообщества, Развлечения, Утилиты
  - _Требования: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 4.1, 4.2, 4.3, 4.4_

- [x] 6. Разработка базового веб-интерфейса




  - Создать HTML страницы для авторизации, дашборда и редактора ботов
  - Реализовать базовую навигацию между страницами
  - Создать форму для создания нового бота с выбором шаблона
  - Реализовать список созданных ботов с возможностью редактирования
  - Добавить базовые стили CSS для удобного интерфейса
  - _Требования: 3.1, 3.2_

- [x] 7. Создание простого визуального редактора

  - Реализовать drag-and-drop интерфейс для создания логики бота
  - Создать палитру компонентов (триггеры, действия, условия)
  - Реализовать возможность соединения узлов для создания потока
  - Добавить панель свойств для настройки параметров узлов
  - Реализовать сохранение конфигурации в JSON формате
  - _Требования: 3.1, 3.2, 3.3, 3.4_

- [x] 8. Разработка среды выполнения ботов




  - Создать класс BotRuntime для управления запущенными ботами
  - Реализовать загрузку конфигураций ботов из файловой системы
  - Создать систему обработки webhook'ов от Telegram
  - Реализовать маршрутизацию сообщений к соответствующим ботам по токену
  - Добавить базовую обработку команд и текстовых сообщений
  - _Требования: 1.1, 1.2, 1.3_

- [x] 9. Реализация основных типов узлов для ботов




  - Создать узел "Триггер сообщения" для обработки входящих сообщений
  - Создать узел "Отправка сообщения" для ответов пользователям
  - Создать узел "Условие" для проверки содержимого сообщений
  - Реализовать узел "Модерация" для автоматического удаления/блокировки
  - Добавить узел "Сохранение данных" для работы с пользовательскими данными
  - _Требования: 1.1, 1.2, 1.3, 1.4_






- [x] 10. Создание системы логирования и статистики
  - Реализовать запись логов работы ботов в файлы по месяцам

  - Создать API endpoint для получения статистики бота
  - Реализовать подсчет обработанных сообщений и активных пользователей
  - Добавить отображение статистики в веб-интерфейсе
  - _Требования: 5.1, 5.2, 5.3, 5.4_

- [x] 11. Реализация системы ограничений и подписок





  - Создать проверку лимитов для бесплатных пользователей (1 бот)
  - Реализовать блокировку создания дополнительных ботов для free плана
  - Добавить проверку доступа к премиум шаблонам
  - Создать заглушки для системы оплаты (для будущего развития)



  - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 12. Создание системы развертывания ботов




  - Реализовать автоматическую регистрацию webhook'ов в Telegram API



  - Создать процесс активации/деактивации ботов
  - Добавить проверку валидности токенов ботов

  - Реализовать автоматический перезапуск ботов при изменении конфигурации
  - _Требования: 6.1, 6.2, 6.3, 6.4_

- [x] 13. Тестирование и отладка системы





  - Создать тестовых ботов для проверки всех типов шаблонов
  - Протестировать создание, редактирование и удаление ботов

  - Проверить работу системы авторизации и ограничений
  - Протестировать обработку различных типов сообщений в Telegram
  - Исправить найденные ошибки и оптимизировать производительность

- [x] 14. Подготовка к развертыванию на Raspberry Pi




  - Создать Docker контейнер для приложения
  - Настроить автоматический запуск при старте системы
  - Создать скрипты для резервного копирования данных
  - Подготовить документацию по установке и настройке


  - Протестировать работу на Raspberry Pi

- [x] 15. ~~Интеграция с готовыми группами для тестирования~~ (Перенесено в план пользовательского тестирования)
  - ~~Создать ботов для модерации существующих Telegram групп~~
  - ~~Протестировать работу с реальными пользователями~~
  - ~~Собрать обратную связь и внести необходимые улучшения~~
  - ~~Оптимизировать производительность на основе реального использования~~
  - **Примечание**: Эта задача не относится к программированию и должна выполняться после завершения разработки

- [x] 16. Улучшение системы запуска через bat-файл
  - Реализовать точное управление процессами приложения
  - Создать PID-файл для отслеживания запущенного процесса
  - Улучшить start.bat для корректного закрытия предыдущих экземпляров
  - Добавить проверку успешности запуска и вывод статуса
  - Создать stop.bat для корректного завершения приложения
  - _Требования: 6.1, 6.2_

- [x] 17. Очистка устаревших файлов и подготовка к миграции


  - Удалить устаревшие JS файлы визуального редактора:
    - `public/js/TemplatePanel.js`, `public/js/TemplateWizard.js`, `public/js/TemplateSystem.js`
    - `public/js/ModulePanel.js`, `public/js/ModuleSystem.js`
    - `public/js/ConnectionTypesPanel.js`, `public/js/ConnectionManager.js`, `public/js/ConnectionTypes.js`
    - `public/js/SuggestionsPanel.js`, `public/js/SmartSuggestions.js`
    - `public/js/ComplexityLevelSwitcher.js`
  - Удалить экспериментальные файлы:
    - `public/app-new.js`, `public/js/app-simple.js`
    - `public/js/SimpleVisualEditor.js`
  - Удалить устаревшие API роуты:
    - `routes/bots-no-auth.js`, `routes/bots-simple.js`
  - Создать резервную копию текущего состояния перед миграцией
  - _Требования: 3.1, 3.2_







- [ ] 18. Настройка современного фронтенд стека (TypeScript + Vite + React)
  - Инициализировать новый React проект с Vite и TypeScript



  - Настроить CSS Modules для стилизации компонентов
  - Установить и настроить React Flow для визуального редактора

  - Настроить Jest + React Testing Library для тестирования
  - Создать базовую структуру компонентов с TypeScript интерфейсами











  - Настроить сборку статических файлов в public/ для интеграции с Express
  - _Требования: 3.1, 3.2, 3.3, 3.4_







- [x] 19. Миграция визуального редактора на React Flow







  - Создать TypeScript интерфейсы для узлов и соединений
  - Реализовать кастомные типы узлов для React Flow (триггеры, действия, условия)


  - Создать библиотеку узлов с drag-and-drop функциональностью


  - Реализовать панель свойств для настройки узлов
  - Добавить валидацию соединений между узлами
  - Интегрировать с существующим API для сохранения/загрузки схем
  - _Требования: 3.1, 3.2, 3.3, 3.4_




- [ ] 20. Создание двухоконного интерфейса (дашборд + редактор)
  - Реализовать главный дашборд со списком ботов и статистикой
  - Создать отдельное окно/страницу для визуального редактора
  - Настроить навигацию между дашбордом и редактором
  - Реализовать состояние приложения с Context API или Redux Toolkit
  - Добавить адаптивный дизайн для разных размеров экрана
  - _Требования: 3.1, 3.2_

- [ ] 21. Написание тестов для новых компонентов
  - Создать unit тесты для React компонентов с Jest + RTL
  - Написать тесты для кастомных хуков и утилит
  - Добавить интеграционные тесты для взаимодействия с API
  - Настроить coverage reporting для контроля покрытия тестами
  - Создать тесты для React Flow интеграции
  - _Требования: 3.1, 3.2, 3.3, 3.4_

- [ ] 22. Упрощение интерфейса для разработки
  - Убрать систему уровней сложности (Новичок/Продвинутый/Эксперт)
  - Объединить все функции в единый простой интерфейс
  - Исправить проблему с зависанием на стартовом экране
  - Сделать прямой переход к основному функционалу
  - Оптимизировать производительность нового React интерфейса
  - _Требования: 3.1, 3.2_