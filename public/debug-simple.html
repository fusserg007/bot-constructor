<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 10px 0; }
        .info { color: blue; background: #e6f3ff; padding: 10px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>üîß –ü—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Bot Constructor</h1>
    
    <div id="errors"></div>
    
    <div class="info">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
        <div id="load-status">‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>
    
    <div class="info">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h2>
        <button onclick="testAPI()">–¢–µ—Å—Ç API</button>
        <div id="api-status"></div>
    </div>
    
    <div class="info">
        <h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h2>
        <button onclick="checkElements()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</button>
        <div id="elements-status"></div>
    </div>
    
    <div class="info">
        <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π</h2>
        <button onclick="checkFunctions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏</button>
        <div id="functions-status"></div>
    </div>
    
    <div class="info">
        <h2>5. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥</h2>
        <button onclick="testBackButton()">–¢–µ—Å—Ç backToDashboard()</button>
        <div id="back-status"></div>
    </div>

    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏
        const errors = [];
        
        window.addEventListener('error', (e) => {
            errors.push(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`);
            updateErrors();
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            errors.push(`Promise Rejection: ${e.reason}`);
            updateErrors();
        });
        
        function updateErrors() {
            const errorDiv = document.getElementById('errors');
            if (errors.length > 0) {
                errorDiv.innerHTML = '<div class="error"><h3>‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h3>' + 
                    errors.map(err => `<div>${err}</div>`).join('') + '</div>';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        document.addEventListener('DOMContentLoaded', () => {
            const loadStatus = document.getElementById('load-status');
            loadStatus.innerHTML = '‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (window.botConstructor) {
                    loadStatus.innerHTML += '<br>‚úÖ window.botConstructor –Ω–∞–π–¥–µ–Ω';
                } else {
                    loadStatus.innerHTML += '<br>‚ùå window.botConstructor –ù–ï –Ω–∞–π–¥–µ–Ω';
                }
                
                if (typeof window.backToDashboard === 'function') {
                    loadStatus.innerHTML += '<br>‚úÖ window.backToDashboard –Ω–∞–π–¥–µ–Ω';
                } else {
                    loadStatus.innerHTML += '<br>‚ùå window.backToDashboard –ù–ï –Ω–∞–π–¥–µ–Ω';
                }
            }, 2000);
        });
        
        async function testAPI() {
            const status = document.getElementById('api-status');
            try {
                status.innerHTML = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º API...';
                const response = await fetch('/api/stats/dashboard');
                const data = await response.json();
                status.innerHTML = `‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>–ë–æ—Ç–æ–≤: ${data.data?.totalBots || 0}<br>–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${data.data?.activeBots || 0}`;
                status.className = 'success';
            } catch (error) {
                status.innerHTML = `‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`;
                status.className = 'error';
            }
        }
        
        function checkElements() {
            const status = document.getElementById('elements-status');
            const elements = [
                'dashboard-view',
                'constructor-view', 
                'totalBots',
                'activeBots',
                'botsContainer',
                'editorCanvas'
            ];
            
            let html = '';
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    html += `‚úÖ ${id} –Ω–∞–π–¥–µ–Ω<br>`;
                } else {
                    html += `‚ùå ${id} –ù–ï –Ω–∞–π–¥–µ–Ω<br>`;
                }
            });
            
            status.innerHTML = html;
        }
        
        function checkFunctions() {
            const status = document.getElementById('functions-status');
            const functions = [
                'backToDashboard',
                'editBot',
                'createNewBot',
                'debugApp'
            ];
            
            let html = '';
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    html += `‚úÖ ${funcName} –Ω–∞–π–¥–µ–Ω–∞<br>`;
                } else {
                    html += `‚ùå ${funcName} –ù–ï –Ω–∞–π–¥–µ–Ω–∞<br>`;
                }
            });
            
            if (window.botConstructor) {
                html += `‚úÖ botConstructor –æ–±—ä–µ–∫—Ç –Ω–∞–π–¥–µ–Ω<br>`;
                html += `- currentView: ${window.botConstructor.currentView || '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}<br>`;
                html += `- currentBot: ${window.botConstructor.currentBot?.name || '–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'}<br>`;
            } else {
                html += `‚ùå botConstructor –æ–±—ä–µ–∫—Ç –ù–ï –Ω–∞–π–¥–µ–Ω<br>`;
            }
            
            status.innerHTML = html;
        }
        
        function testBackButton() {
            const status = document.getElementById('back-status');
            try {
                if (typeof window.backToDashboard === 'function') {
                    status.innerHTML = '‚è≥ –í—ã–∑—ã–≤–∞–µ–º backToDashboard()...<br>';
                    window.backToDashboard();
                    status.innerHTML += '‚úÖ –§—É–Ω–∫—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫<br>';
                    status.className = 'success';
                } else {
                    status.innerHTML = '‚ùå –§—É–Ω–∫—Ü–∏—è backToDashboard –Ω–µ –Ω–∞–π–¥–µ–Ω–∞<br>';
                    status.className = 'error';
                }
            } catch (error) {
                status.innerHTML += `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ: ${error.message}<br>`;
                status.className = 'error';
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            testAPI();
            checkElements();
            checkFunctions();
        }, 3000);
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script src="app.js"></script>
</body>
</html>