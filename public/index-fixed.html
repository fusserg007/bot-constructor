<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Constructor - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ */
        .app-container {
            min-height: 100vh;
            background: #f5f5f5;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        .error-banner {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        .success-banner {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div id="loadingStatus" class="success-banner">
        ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...
    </div>

    <div class="app-container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ - –î–∞—à–±–æ—Ä–¥ —Å –±–æ—Ç–∞–º–∏ -->
        <div id="dashboard-view" class="view active">
            <header class="dashboard-header">
                <h1>ü§ñ Bot Constructor (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)</h1>
                <p>–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏</p>
            </header>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ü§ñ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalBots">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –±–æ—Ç–æ–≤</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="activeBots">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div class="stat-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ -->
            <div class="bots-section">
                <div class="section-header">
                    <h2>üìã –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤</h2>
                    <button class="btn btn-primary" onclick="createNewBot()">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
                    </button>
                </div>
                <div id="botsContainer" class="bots-grid">
                    <div class="loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –±–æ—Ç–æ–≤...</div>
                </div>
            </div>
        </div>

        <!-- –û–∫–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ -->
        <div id="constructor-view" class="view">
            <header class="constructor-header">
                <button class="btn btn-secondary" onclick="backToDashboard()">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </button>
                <div class="current-bot-info">
                    <h2 id="constructorBotName">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–∞</h2>
                    <span id="constructorBotStatus" class="bot-status"></span>
                </div>
                <div class="constructor-actions">
                    <button class="btn btn-info" onclick="showGeneratedCode()">
                        üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥
                    </button>
                    <button class="btn btn-primary" onclick="validateCurrentSchema()">
                        ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    </button>
                    <button class="btn btn-success" onclick="saveBotSchema()">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button class="btn btn-warning" onclick="testBot()">
                        ‚ñ∂Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </header>

            <div class="constructor-workspace">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–∑–ª–æ–≤ -->
                <div class="left-panel">
                    <h3>üß© –£–∑–ª—ã</h3>
                    <div class="node-categories">
                        <div class="node-category">
                            <h4>üì® –¢—Ä–∏–≥–≥–µ—Ä—ã</h4>
                            <div class="node-item" draggable="true" data-type="start">
                                <span class="node-icon">üöÄ</span>
                                <span>–°—Ç–∞—Ä—Ç</span>
                            </div>
                            <div class="node-item" draggable="true" data-type="command">
                                <span class="node-icon">‚ö°</span>
                                <span>–ö–æ–º–∞–Ω–¥–∞</span>
                            </div>
                            <div class="node-item" draggable="true" data-type="text">
                                <span class="node-icon">üí¨</span>
                                <span>–¢–µ–∫—Å—Ç</span>
                            </div>
                        </div>
                        
                        <div class="node-category">
                            <h4>üéØ –î–µ–π—Å—Ç–≤–∏—è</h4>
                            <div class="node-item" draggable="true" data-type="message">
                                <span class="node-icon">üì§</span>
                                <span>–°–æ–æ–±—â–µ–Ω–∏–µ</span>
                            </div>
                            <div class="node-item" draggable="true" data-type="keyboard">
                                <span class="node-icon">‚å®Ô∏è</span>
                                <span>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</span>
                            </div>
                            <div class="node-item" draggable="true" data-type="photo">
                                <span class="node-icon">üñºÔ∏è</span>
                                <span>–§–æ—Ç–æ</span>
                            </div>
                        </div>
                        
                        <div class="node-category">
                            <h4>üîÄ –õ–æ–≥–∏–∫–∞</h4>
                            <div class="node-item" draggable="true" data-type="condition">
                                <span class="node-icon">‚ùì</span>
                                <span>–£—Å–ª–æ–≤–∏–µ</span>
                            </div>
                            <div class="node-item" draggable="true" data-type="delay">
                                <span class="node-icon">‚è±Ô∏è</span>
                                <span>–ó–∞–¥–µ—Ä–∂–∫–∞</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - Canvas -->
                <div class="center-panel">
                    <div class="canvas-container">
                        <canvas id="editorCanvas" width="800" height="600"></canvas>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –°–≤–æ–π—Å—Ç–≤–∞ –∏ –∫–æ–¥ -->
                <div class="right-panel">
                    <div class="panel-tabs">
                        <button class="tab-btn active" onclick="showTab('properties')">‚öôÔ∏è –°–≤–æ–π—Å—Ç–≤–∞</button>
                        <button class="tab-btn" onclick="showTab('code')">üìÑ –ö–æ–¥</button>
                    </div>
                    
                    <div id="properties-tab" class="tab-content active">
                        <div id="propertiesPanel">
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                        </div>
                    </div>
                    
                    <div id="code-tab" class="tab-content">
                        <div class="code-header">
                            <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥</h4>
                            <button class="btn btn-sm" onclick="copyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <pre id="generatedCode" class="code-block">
// –ö–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã –±–æ—Ç–∞
                        </pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="codeModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –±–æ—Ç–∞</h3>
                <span class="close" onclick="closeCodeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="code-tabs">
                    <button class="code-tab-btn active" onclick="showCodeTab('main')">main.js</button>
                    <button class="code-tab-btn" onclick="showCodeTab('handlers')">handlers.js</button>
                    <button class="code-tab-btn" onclick="showCodeTab('config')">config.json</button>
                </div>
                <pre id="fullGeneratedCode" class="code-block large"></pre>
                <div class="code-actions">
                    <button class="btn btn-primary" onclick="downloadCode()">üíæ –°–∫–∞—á–∞—Ç—å</button>
                    <button class="btn btn-secondary" onclick="copyFullCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
        function updateLoadingStatus(message, type = 'success') {
            const status = document.getElementById('loadingStatus');
            if (status) {
                status.textContent = message;
                status.className = type + '-banner';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', () => {
            updateLoadingStatus('‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–∂–∏–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤...');
            
            setTimeout(() => {
                if (typeof window.createNewBot === 'function') {
                    updateLoadingStatus('‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                    // –°–∫—Ä—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        const status = document.getElementById('loadingStatus');
                        if (status) status.style.display = 'none';
                    }, 3000);
                } else {
                    updateLoadingStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤', 'error');
                }
            }, 2000);
        });
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            updateLoadingStatus(`‚ùå JavaScript –æ—à–∏–±–∫–∞: ${e.message}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.warn('Promise rejection (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):', e.reason);
        });
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/VisualEditor.js"></script>
    <script src="app.js"></script>
</body>
</html>