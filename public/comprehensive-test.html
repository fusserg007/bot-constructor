<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ - Bot Constructor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîß –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Bot Constructor</h1>
    
    <div class="test-section">
        <h2>1. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"</h2>
        <button onclick="testBackButton()">üîô –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥</button>
        <div id="backButtonResult" class="test-result info">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
    </div>
    
    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</h2>
        <button onclick="testCardSizes()">üìè –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</button>
        <div id="cardSizeResult" class="test-result info">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
        <div id="cardSizeDemo" style="display: none;">
            <div class="bots-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 10px;">
                <div class="bot-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e1e8ed;">
                    <div class="bot-card-title" style="font-weight: bold; margin-bottom: 0.5rem;">–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ 1</div>
                    <div>–†–∞–∑–º–µ—Ä: <span id="card1Size"></span></div>
                </div>
                <div class="bot-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e1e8ed;">
                    <div class="bot-card-title" style="font-weight: bold; margin-bottom: 0.5rem;">–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ 2</div>
                    <div>–†–∞–∑–º–µ—Ä: <span id="card2Size"></span></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
        <button onclick="testDataLoading()">üì° –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</button>
        <div id="dataLoadingResult" class="test-result info">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
    </div>
    
    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç —Å–∫—Ä–æ–ª–∏–Ω–≥–∞</h2>
        <button onclick="testScrolling()">üìú –¢–µ—Å—Ç —Å–∫—Ä–æ–ª–∏–Ω–≥–∞</button>
        <div id="scrollingResult" class="test-result info">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
        <div id="scrollDemo" style="display: none;">
            <div class="left-panel" style="width: 250px; background: white; border: 1px solid #e1e8ed; padding: 1rem; overflow-y: auto; height: 200px; max-height: 200px;">
                <div>–≠–ª–µ–º–µ–Ω—Ç 1</div><div>–≠–ª–µ–º–µ–Ω—Ç 2</div><div>–≠–ª–µ–º–µ–Ω—Ç 3</div><div>–≠–ª–µ–º–µ–Ω—Ç 4</div><div>–≠–ª–µ–º–µ–Ω—Ç 5</div>
                <div>–≠–ª–µ–º–µ–Ω—Ç 6</div><div>–≠–ª–µ–º–µ–Ω—Ç 7</div><div>–≠–ª–µ–º–µ–Ω—Ç 8</div><div>–≠–ª–µ–º–µ–Ω—Ç 9</div><div>–≠–ª–µ–º–µ–Ω—Ç 10</div>
                <div>–≠–ª–µ–º–µ–Ω—Ç 11</div><div>–≠–ª–µ–º–µ–Ω—Ç 12</div><div>–≠–ª–µ–º–µ–Ω—Ç 13</div><div>–≠–ª–µ–º–µ–Ω—Ç 14</div><div>–≠–ª–µ–º–µ–Ω—Ç 15</div>
                <div>–≠–ª–µ–º–µ–Ω—Ç 16</div><div>–≠–ª–µ–º–µ–Ω—Ç 17</div><div>–≠–ª–µ–º–µ–Ω—Ç 18</div><div>–≠–ª–µ–º–µ–Ω—Ç 19</div><div>–≠–ª–µ–º–µ–Ω—Ç 20</div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>5. –¢–µ—Å—Ç —Å—Ö–µ–º –±–æ—Ç–æ–≤</h2>
        <button onclick="testBotSchemas()">ü§ñ –¢–µ—Å—Ç —Å—Ö–µ–º –±–æ—Ç–æ–≤</button>
        <div id="botSchemasResult" class="test-result info">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
    </div>
    
    <div class="test-section">
        <h2>üìã –û–±—â–∏–π –ª–æ–≥</h2>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <button onclick="copyLog()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥</button>
        <button onclick="exportLog()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
        <button onclick="forceInit()">üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</button>
        <div id="testLog" class="log">–õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...\n</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logElement = document.getElementById('testLog');
            const time = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logElement.innerHTML += `[${time}] ${icon} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...\n';
        }
        
        function copyLog() {
            const logElement = document.getElementById('testLog');
            const logText = logElement.textContent || logElement.innerText;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(logText).then(() => {
                    log('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                }).catch(() => {
                    fallbackCopyLog(logText);
                });
            } else {
                fallbackCopyLog(logText);
            }
        }
        
        function fallbackCopyLog(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                log('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (fallback)', 'success');
            } catch (err) {
                log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥', 'error');
            }
            document.body.removeChild(textArea);
        }
        
        function exportLog() {
            const logElement = document.getElementById('testLog');
            const logText = logElement.textContent || logElement.innerText;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const filename = `bot-constructor-test-log-${timestamp}.txt`;
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            log(`üíæ –õ–æ–≥ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: ${filename}`, 'success');
        }
        
        function forceInit() {
            log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 'info');
            try {
                if (typeof window.BotConstructor !== 'undefined' && !window.botConstructor) {
                    window.botConstructor = new window.BotConstructor();
                    log('‚úÖ window.botConstructor –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                    
                    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
                    setTimeout(() => {
                        log('üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥...', 'info');
                        testBackButton();
                    }, 500);
                } else if (window.botConstructor) {
                    log('‚ÑπÔ∏è window.botConstructor —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'info');
                } else {
                    log('‚ùå –ö–ª–∞—Å—Å BotConstructor –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        function setResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
        }

        // 1. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
        function testBackButton() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥...');
            
            try {
                // –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                log(`üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: window.BotConstructor = ${typeof window.BotConstructor}`, 'info');
                log(`üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: window.botConstructor = ${typeof window.botConstructor}`, 'info');
                log(`üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: window.backToDashboard = ${typeof window.backToDashboard}`, 'info');
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ app.js –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                setTimeout(() => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ backToDashboard
                    if (typeof window.backToDashboard === 'function') {
                        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
                        if (window.botConstructor && typeof window.botConstructor.showView === 'function') {
                            setResult('backButtonResult', '‚úÖ –§—É–Ω–∫—Ü–∏—è backToDashboard –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞', 'success');
                            log('‚úÖ –§—É–Ω–∫—Ü–∏—è backToDashboard —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ window.botConstructor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                        } else if (window.botConstructor) {
                            setResult('backButtonResult', '‚ö†Ô∏è backToDashboard –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ showView –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                            log('‚ö†Ô∏è window.botConstructor –Ω–∞–π–¥–µ–Ω, –Ω–æ showView –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                        } else {
                            setResult('backButtonResult', '‚ö†Ô∏è backToDashboard –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ botConstructor –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                            log('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è backToDashboard —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ window.botConstructor –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                        }
                    } else if (window.botConstructor && typeof window.botConstructor.showView === 'function') {
                        setResult('backButtonResult', '‚úÖ BotConstructor.showView –Ω–∞–π–¥–µ–Ω (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)', 'success');
                        log('‚úÖ BotConstructor.showView –Ω–∞–π–¥–µ–Ω –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ backToDashboard', 'success');
                    } else if (typeof window.BotConstructor !== 'undefined') {
                        setResult('backButtonResult', '‚ö†Ô∏è BotConstructor –∫–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω, –Ω–æ —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ —Å–æ–∑–¥–∞–Ω', 'warning');
                        log('‚ö†Ô∏è BotConstructor –∫–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω, –Ω–æ window.botConstructor –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                    } else {
                        setResult('backButtonResult', '‚ùå –§—É–Ω–∫—Ü–∏—è backToDashboard –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        log('‚ùå –§—É–Ω–∫—Ü–∏—è backToDashboard –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ DOM
                    const backButtons = document.querySelectorAll('[onclick*="backToDashboard"]');
                    if (backButtons.length > 0) {
                        log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${backButtons.length} –∫–Ω–æ–ø–æ–∫ —Å backToDashboard`, 'success');
                    } else {
                        log('‚ùå –ö–Ω–æ–ø–∫–∏ —Å backToDashboard –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM', 'error');
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
                    if (typeof window.backToDashboard === 'function') {
                        const testButton = document.createElement('button');
                        testButton.textContent = 'üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"';
                        testButton.className = 'btn btn-secondary btn-sm';
                        testButton.onclick = () => {
                            try {
                                log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é backToDashboard...', 'info');
                                window.backToDashboard();
                                log('‚úÖ –§—É–Ω–∫—Ü–∏—è backToDashboard –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫', 'success');
                            } catch (error) {
                                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ backToDashboard: ${error.message}`, 'error');
                            }
                        };
                        
                        const resultDiv = document.getElementById('backButtonResult');
                        if (resultDiv) {
                            resultDiv.appendChild(document.createElement('br'));
                            resultDiv.appendChild(testButton);
                        }
                    }
                }, 2000); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                
            } catch (error) {
                setResult('backButtonResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥: ${error.message}`, 'error');
            }
        }

        // 2. –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        function testCardSizes() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫...');
            
            try {
                const demo = document.getElementById('cardSizeDemo');
                demo.style.display = 'block';
                
                setTimeout(() => {
                    const cards = demo.querySelectorAll('.bot-card');
                    let allGood = true;
                    
                    cards.forEach((card, index) => {
                        const rect = card.getBoundingClientRect();
                        const sizeSpan = document.getElementById(`card${index + 1}Size`);
                        sizeSpan.textContent = `${Math.round(rect.width)}x${Math.round(rect.height)}px`;
                        
                        if (rect.width < 200) {
                            allGood = false;
                            log(`‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∞ ${index + 1} —Å–ª–∏—à–∫–æ–º —É–∑–∫–∞—è: ${Math.round(rect.width)}px`, 'warning');
                        }
                    });
                    
                    if (allGood) {
                        setResult('cardSizeResult', '‚úÖ –†–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ', 'success');
                        log('‚úÖ –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä', 'success');
                    } else {
                        setResult('cardSizeResult', '‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–º–µ—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä', 'warning');
                    }
                }, 100);
                
            } catch (error) {
                setResult('cardSizeResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫: ${error.message}`, 'error');
            }
        }

        // 3. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function testDataLoading() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                setResult('dataLoadingResult', 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...', 'info');
                
                const response = await fetch('/api/bots');
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.data && data.data.bots) {
                        setResult('dataLoadingResult', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.data.bots.length} –±–æ—Ç–æ–≤`, 'success');
                        log(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${data.data.bots.length} –±–æ—Ç–æ–≤`, 'success');
                    } else {
                        setResult('dataLoadingResult', '‚ö†Ô∏è API –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ', 'warning');
                        log('‚ö†Ô∏è API –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ', 'warning');
                    }
                } else {
                    setResult('dataLoadingResult', `‚ùå API –æ—à–∏–±–∫–∞: ${response.status}`, 'error');
                    log(`‚ùå API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`, 'error');
                }
                
            } catch (error) {
                setResult('dataLoadingResult', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            }
        }

        // 4. –¢–µ—Å—Ç —Å–∫—Ä–æ–ª–∏–Ω–≥–∞
        function testScrolling() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–æ–ª–∏–Ω–≥–∞...');
            
            try {
                const demo = document.getElementById('scrollDemo');
                demo.style.display = 'block';
                
                setTimeout(() => {
                    const scrollContainer = demo.querySelector('.left-panel');
                    const initialScrollTop = scrollContainer.scrollTop;
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                    scrollContainer.scrollTop = 100;
                    
                    setTimeout(() => {
                        if (scrollContainer.scrollTop > initialScrollTop) {
                            setResult('scrollingResult', '‚úÖ –°–∫—Ä–æ–ª–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                            log('‚úÖ –°–∫—Ä–æ–ª–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                        } else {
                            setResult('scrollingResult', '‚ùå –°–∫—Ä–æ–ª–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                            log('‚ùå –°–∫—Ä–æ–ª–∏–Ω–≥ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç', 'error');
                        }
                    }, 100);
                }, 100);
                
            } catch (error) {
                setResult('scrollingResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä–æ–ª–∏–Ω–≥–∞: ${error.message}`, 'error');
            }
        }

        // 5. –¢–µ—Å—Ç —Å—Ö–µ–º –±–æ—Ç–æ–≤
        async function testBotSchemas() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º –±–æ—Ç–æ–≤...');
            
            try {
                setResult('botSchemasResult', 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...', 'info');
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤
                const listResponse = await fetch('/api/bots');
                if (!listResponse.ok) {
                    throw new Error(`–°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${listResponse.status}`);
                }
                
                const listData = await listResponse.json();
                if (!listData.success || !listData.data.bots.length) {
                    throw new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
                
                // –ë–µ—Ä–µ–º –ø–µ—Ä–≤–æ–≥–æ –±–æ—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
                const firstBot = listData.data.bots[0];
                log(`üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ö–µ–º—É –±–æ—Ç–∞: ${firstBot.id}`, 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ö–µ–º—É
                const response = await fetch(`/api/bots/${firstBot.id}`);
                
                if (response.ok) {
                    const botData = await response.json();
                    
                    if (botData.success && botData.data) {
                        const bot = botData.data;
                        const hasNodes = bot.configuration && bot.configuration.nodes && bot.configuration.nodes.length > 0;
                        
                        if (hasNodes) {
                            setResult('botSchemasResult', `‚úÖ –°—Ö–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞: ${bot.configuration.nodes.length} —É–∑–ª–æ–≤`, 'success');
                            log(`‚úÖ –°—Ö–µ–º–∞ –±–æ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç ${bot.configuration.nodes.length} —É–∑–ª–æ–≤`, 'success');
                        } else {
                            setResult('botSchemasResult', '‚ö†Ô∏è –°—Ö–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –ø—É—Å—Ç–∞—è', 'warning');
                            log('‚ö†Ô∏è –°—Ö–µ–º–∞ –±–æ—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–∑–ª–æ–≤', 'warning');
                        }
                    } else {
                        setResult('botSchemasResult', '‚ùå –°—Ö–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        log('‚ùå –°—Ö–µ–º–∞ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                } else {
                    setResult('botSchemasResult', `‚ùå –û—à–∏–±–∫–∞ API: ${response.status}`, 'error');
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ö–µ–º—ã: ${response.status}`, 'error');
                }
                
            } catch (error) {
                setResult('botSchemasResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        function runAllTests() {
            log('üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
            
            setTimeout(() => testBackButton(), 500);
            setTimeout(() => testCardSizes(), 1000);
            setTimeout(() => testDataLoading(), 1500);
            setTimeout(() => testScrolling(), 2000);
            setTimeout(() => testBotSchemas(), 2500);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ app.js —Å –Ω–æ–≤—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function checkAppJS() {
            return new Promise((resolve) => {
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º—É –æ—Ç–ª–∞–¥–∫–∏
                if (!window.editorDebugger) {
                    log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ EditorDebugger...', 'info');
                    const debugScript = document.createElement('script');
                    debugScript.src = 'js/EditorDebugger.js';
                    debugScript.onload = () => {
                        log('‚úÖ EditorDebugger –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                        loadBotConstructorManager();
                    };
                    debugScript.onerror = () => {
                        log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ EditorDebugger, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –Ω–µ–≥–æ', 'warning');
                        loadBotConstructorManager();
                    };
                    document.head.appendChild(debugScript);
                } else {
                    loadBotConstructorManager();
                }
                
                function loadBotConstructorManager() {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    if (!window.BotConstructorManager) {
                        log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ BotConstructorManager...', 'info');
                        const managerScript = document.createElement('script');
                        managerScript.src = 'js/BotConstructorManager.js';
                        managerScript.onload = () => {
                            log('‚úÖ BotConstructorManager –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                            loadAppJS();
                        };
                        managerScript.onerror = () => {
                            log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ BotConstructorManager', 'error');
                            loadAppJS(); // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å app.js –±–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
                        };
                        document.head.appendChild(managerScript);
                    } else {
                        loadAppJS();
                    }
                }
                
                function loadAppJS() {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ —É–∂–µ app.js
                    if (typeof window.BotConstructor !== 'undefined') {
                        log('‚úÖ app.js —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                        waitForInitialization();
                    } else {
                        // –ï—Å–ª–∏ app.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
                        log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ app.js...', 'info');
                        const script = document.createElement('script');
                        script.src = 'app.js';
                        script.onload = () => {
                            log('‚úÖ app.js –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏', 'success');
                            waitForInitialization();
                        };
                        script.onerror = () => {
                            log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ app.js', 'error');
                            resolve();
                        };
                        document.head.appendChild(script);
                    }
                }
                
                function waitForInitialization() {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
                    if (window.botConstructorManager) {
                        log('üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º BotConstructorManager –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'info');
                        window.botConstructorManager.initialize()
                            .then(() => {
                                log('‚úÖ BotConstructor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä', 'success');
                                resolve();
                            })
                            .catch((error) => {
                                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä: ${error.message}`, 'error');
                                resolve();
                            });
                    } else {
                        // Fallback –∫ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–µ
                        log('‚ö†Ô∏è BotConstructorManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É', 'warning');
                        let attempts = 0;
                        const checkInit = () => {
                            attempts++;
                            if (window.botConstructor) {
                                log('‚úÖ BotConstructor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)', 'success');
                                resolve();
                            } else if (attempts < 10) {
                                setTimeout(checkInit, 200);
                            } else {
                                log('‚ö†Ô∏è BotConstructor –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è', 'warning');
                                resolve();
                            }
                        };
                        checkInit();
                    }
                }
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            log('üìã –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º app.js
            await checkAppJS();
            
            // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>