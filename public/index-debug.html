<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Constructor - Debug</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            max-width: 300px;
        }
        .debug-log {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <div><strong>Debug Info:</strong></div>
        <div id="debug-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="debug-log" id="debug-log"></div>
    </div>

    <div class="app-container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ - –î–∞—à–±–æ—Ä–¥ —Å –±–æ—Ç–∞–º–∏ -->
        <div id="dashboard-view" class="view active">
            <header class="dashboard-header">
                <h1>ü§ñ Bot Constructor (Debug)</h1>
                <p>–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏</p>
            </header>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ü§ñ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalBots">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –±–æ—Ç–æ–≤</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="activeBots">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div class="stat-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ -->
            <div class="bots-section">
                <div class="section-header">
                    <h2>üìã –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤</h2>
                    <button class="btn btn-primary" onclick="createNewBot()">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
                    </button>
                </div>
                <div id="botsContainer" class="bots-grid">
                    <div class="loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –±–æ—Ç–æ–≤...</div>
                </div>
            </div>
        </div>

        <!-- –û–∫–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ -->
        <div id="constructor-view" class="view">
            <header class="constructor-header">
                <button class="btn btn-secondary" onclick="backToDashboard()">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </button>
                <div class="current-bot-info">
                    <h2 id="constructorBotName">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–∞</h2>
                    <span id="constructorBotStatus" class="bot-status"></span>
                </div>
            </header>
            <div class="constructor-workspace">
                <p>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
            </div>
        </div>
    </div>

    <script>
        // Debug —Å–∏—Å—Ç–µ–º–∞
        const debugStatus = document.getElementById('debug-status');
        const debugLog = document.getElementById('debug-log');
        
        function debugMsg(msg) {
            console.log('[DEBUG]', msg);
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<div>[${time}] ${msg}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        function updateStatus(status) {
            debugStatus.textContent = status;
            debugMsg('Status: ' + status);
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            debugMsg(`ERROR: ${e.message} –≤ ${e.filename}:${e.lineno}`);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            debugMsg(`PROMISE ERROR: ${e.reason}`);
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        updateStatus('HTML –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        document.addEventListener('DOMContentLoaded', () => {
            debugMsg('DOM –≥–æ—Ç–æ–≤');
            updateStatus('DOM –≥–æ—Ç–æ–≤');
        });
        
        window.addEventListener('load', () => {
            debugMsg('–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            updateStatus('–†–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const target = mutation.target;
                    if (target.id && target.id.includes('view')) {
                        debugMsg(`View changed: ${target.id} - ${target.className}`);
                    }
                }
            });
        });
        
        observer.observe(document.body, {
            attributes: true,
            subtree: true,
            attributeFilter: ['class', 'style']
        });
        
        debugMsg('Debug —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤
        setTimeout(() => {
            debugMsg('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π:');
            debugMsg('createNewBot: ' + (typeof window.createNewBot));
            debugMsg('backToDashboard: ' + (typeof window.backToDashboard));
            debugMsg('editBot: ' + (typeof window.editBot));
            
            if (typeof window.createNewBot === 'undefined') {
                debugMsg('–ü–†–û–ë–õ–ï–ú–ê: –§—É–Ω–∫—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                debugMsg('–î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏...');
                
                // –†–µ–∑–µ—Ä–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                window.createNewBot = function() {
                    debugMsg('–†–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è createNewBot –≤—ã–∑–≤–∞–Ω–∞');
                    alert('–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è)');
                };
                
                window.backToDashboard = function() {
                    debugMsg('–†–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è backToDashboard –≤—ã–∑–≤–∞–Ω–∞');
                    alert('–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –¥–∞—à–±–æ—Ä–¥—É (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è)');
                };
                
                debugMsg('–†–µ–∑–µ—Ä–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
            } else {
                debugMsg('OK: –§—É–Ω–∫—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }
        }, 1000);
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/VisualEditor.js" onload="debugMsg('VisualEditor.js –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="debugMsg('–û–®–ò–ë–ö–ê –∑–∞–≥—Ä—É–∑–∫–∏ VisualEditor.js')"></script>
    <script src="app.js" onload="debugMsg('app.js –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="debugMsg('–û–®–ò–ë–ö–ê –∑–∞–≥—Ä—É–∑–∫–∏ app.js')"></script>
</body>
</html>