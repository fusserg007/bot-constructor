<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BotConstructor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #ddd;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BotConstructor</h1>
        
        <div id="status" class="status info">
            –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
        </div>
        
        <div class="test-section">
            <h3>üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h3>
            <div id="components-status"></div>
        </div>
        
        <div class="test-section">
            <h3>üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h3>
            <button class="btn" onclick="testBotConstructorManager()">–¢–µ—Å—Ç BotConstructorManager</button>
            <button class="btn" onclick="testBotConstructor()">–¢–µ—Å—Ç BotConstructor</button>
            <button class="btn" onclick="testEditorDebugger()">–¢–µ—Å—Ç EditorDebugger</button>
            <button class="btn" onclick="testGlobalFunctions()">–¢–µ—Å—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π</button>
            <button class="btn" onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        </div>
        
        <div class="test-section">
            <h3>üìù –õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div id="test-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <button class="btn" onclick="reinitialize()">üîÑ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</button>
            <button class="btn" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <button class="btn" onclick="exportDiagnostics()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</button>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É –æ—Ç–ª–∞–¥–∫–∏ -->
    <script src="js/EditorDebugger.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="js/BotConstructorManager.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
    <script src="app.js"></script>
    
    <script>
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            const logElement = document.getElementById('test-log');
            logElement.textContent = testLog.join('\\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }
        
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            log(`STATUS: ${message}`, type);
        }
        
        function updateComponentsStatus() {
            const components = {
                'EditorDebugger': !!window.editorDebugger,
                'BotConstructorManager': !!window.botConstructorManager,
                'BotConstructor –∫–ª–∞—Å—Å': typeof BotConstructor !== 'undefined',
                'window.botConstructor': !!window.botConstructor,
                'backToDashboard': typeof window.backToDashboard === 'function',
                'editBot': typeof window.editBot === 'function',
                'createNewBot': typeof window.createNewBot === 'function'
            };
            
            const statusHtml = Object.entries(components).map(([name, status]) => {
                const icon = status ? '‚úÖ' : '‚ùå';
                const color = status ? 'green' : 'red';
                return `<div style="color: ${color};">${icon} ${name}: ${status ? 'OK' : '–ù–ï –ù–ê–ô–î–ï–ù'}</div>`;
            }).join('');
            
            document.getElementById('components-status').innerHTML = statusHtml;
        }
        
        function testBotConstructorManager() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ BotConstructorManager...', 'info');
            
            if (!window.botConstructorManager) {
                log('‚ùå BotConstructorManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return false;
            }
            
            const status = window.botConstructorManager.getStatus();
            log(`üìä –°—Ç–∞—Ç—É—Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞: ${JSON.stringify(status, null, 2)}`, 'info');
            
            if (status.isInitialized) {
                log('‚úÖ BotConstructorManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                return true;
            } else {
                log('‚ö†Ô∏è BotConstructorManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                return false;
            }
        }
        
        function testBotConstructor() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ BotConstructor...', 'info');
            
            if (!window.botConstructor) {
                log('‚ùå window.botConstructor –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return false;
            }
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                const methods = ['showView', 'loadDashboardData', 'editBot', 'createNewBot'];
                let allMethodsExist = true;
                
                methods.forEach(method => {
                    if (typeof window.botConstructor[method] === 'function') {
                        log(`‚úÖ –ú–µ—Ç–æ–¥ ${method} –Ω–∞–π–¥–µ–Ω`, 'success');
                    } else {
                        log(`‚ùå –ú–µ—Ç–æ–¥ ${method} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                        allMethodsExist = false;
                    }
                });
                
                if (allMethodsExist) {
                    log('‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã BotConstructor –Ω–∞–π–¥–µ–Ω—ã', 'success');
                    return true;
                } else {
                    log('‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã BotConstructor –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç', 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ BotConstructor: ${error.message}`, 'error');
                return false;
            }
        }
        
        function testEditorDebugger() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ EditorDebugger...', 'info');
            
            if (!window.editorDebugger) {
                log('‚ùå EditorDebugger –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return false;
            }
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                window.editorDebugger.info('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç init-test.html');
                window.editorDebugger.success('–¢–µ—Å—Ç EditorDebugger –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ');
                
                log('‚úÖ EditorDebugger —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                return true;
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ EditorDebugger: ${error.message}`, 'error');
                return false;
            }
        }
        
        function testGlobalFunctions() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π...', 'info');
            
            const globalFunctions = [
                'backToDashboard',
                'editBot', 
                'createNewBot',
                'saveBotSchema',
                'testBot',
                'showGeneratedCode',
                'validateCurrentSchema'
            ];
            
            let allFunctionsExist = true;
            
            globalFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ${funcName} –Ω–∞–π–¥–µ–Ω–∞`, 'success');
                } else {
                    log(`‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ${funcName} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 'error');
                    allFunctionsExist = false;
                }
            });
            
            if (allFunctionsExist) {
                log('‚úÖ –í—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã', 'success');
                return true;
            } else {
                log('‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç', 'error');
                return false;
            }
        }
        
        async function runAllTests() {
            log('üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
            
            const tests = [
                { name: 'BotConstructorManager', func: testBotConstructorManager },
                { name: 'BotConstructor', func: testBotConstructor },
                { name: 'EditorDebugger', func: testEditorDebugger },
                { name: '–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏', func: testGlobalFunctions }
            ];
            
            let passedTests = 0;
            
            for (const test of tests) {
                log(`\\n--- –¢–µ—Å—Ç: ${test.name} ---`, 'info');
                const result = test.func();
                if (result) {
                    passedTests++;
                }
                await new Promise(resolve => setTimeout(resolve, 500)); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
            }
            
            log(`\\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:`, 'info');
            log(`‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: ${passedTests}/${tests.length}`, passedTests === tests.length ? 'success' : 'warning');
            
            if (passedTests === tests.length) {
                updateStatus('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
            } else {
                updateStatus(`‚ö†Ô∏è –ü—Ä–æ–π–¥–µ–Ω–æ ${passedTests}/${tests.length} —Ç–µ—Å—Ç–æ–≤`, 'warning');
            }
        }
        
        async function reinitialize() {
            log('üîÑ –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'info');
            updateStatus('–ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 'info');
            
            if (window.botConstructorManager) {
                try {
                    await window.botConstructorManager.reinitialize();
                    log('‚úÖ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                    updateStatus('‚úÖ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
                    updateComponentsStatus();
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                    updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
                }
            } else {
                log('‚ùå BotConstructorManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
                updateStatus('‚ùå –ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }
        
        function clearLog() {
            testLog = [];
            document.getElementById('test-log').textContent = '';
            log('üóëÔ∏è –õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }
        
        function exportDiagnostics() {
            const diagnostics = {
                timestamp: new Date().toISOString(),
                testLog: testLog,
                components: {
                    editorDebugger: !!window.editorDebugger,
                    botConstructorManager: !!window.botConstructorManager,
                    botConstructor: !!window.botConstructor,
                    botConstructorClass: typeof BotConstructor !== 'undefined'
                },
                managerStatus: window.botConstructorManager ? window.botConstructorManager.getStatus() : null,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const blob = new Blob([JSON.stringify(diagnostics, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `init-test-diagnostics-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üíæ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...', 'info');
            updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...', 'info');
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
            setTimeout(() => {
                updateComponentsStatus();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                if (window.botConstructorManager) {
                    const status = window.botConstructorManager.getStatus();
                    if (status.isInitialized) {
                        updateStatus('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'success');
                    } else {
                        updateStatus('‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'warning');
                    }
                } else {
                    updateStatus('‚ùå BotConstructorManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
                log('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.', 'info');
            }, 2000);
        });
    </script>
</body>
</html>