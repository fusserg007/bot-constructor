<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥—á–∏–∫ –±–æ—Ç–æ–≤ - Bot Constructor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .debug-container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }
        
        .debug-header {
            grid-column: 1 / -1;
            background: #1f2937;
            color: white;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .debug-header h1 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .debug-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        
        .debug-sidebar {
            background: white;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
        }
        
        .debug-main {
            background: white;
            overflow-y: auto;
        }
        
        .debug-inspector {
            background: white;
            border-left: 1px solid #e5e7eb;
            overflow-y: auto;
        }
        
        .panel {
            padding: 1rem;
        }
        
        .panel h2 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1f2937;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        
        .bot-selector {
            margin-bottom: 1rem;
        }
        
        .bot-selector input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .session-info {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }
        
        .session-info.running {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }
        
        .session-info.paused {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }
        
        .session-info.error {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        
        .execution-history {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }
        
        .history-item {
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .history-item:hover {
            background: #f9fafb;
        }
        
        .history-item.current {
            background: #dbeafe;
            border-left: 3px solid #3b82f6;
        }
        
        .history-item .step-number {
            font-weight: 600;
            color: #6b7280;
        }
        
        .history-item .node-label {
            font-weight: 500;
            color: #1f2937;
        }
        
        .history-item .timestamp {
            color: #6b7280;
            font-size: 0.7rem;
        }
        
        .variables-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .variable-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.8rem;
        }
        
        .variable-name {
            font-weight: 500;
            color: #1f2937;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        .variable-value {
            color: #6b7280;
            font-family: 'Monaco', 'Menlo', monospace;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .variable-value.string {
            color: #059669;
        }
        
        .variable-value.number {
            color: #dc2626;
        }
        
        .variable-value.boolean {
            color: #7c3aed;
        }
        
        .breakpoints-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .breakpoint-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.8rem;
        }
        
        .breakpoint-node {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #1f2937;
        }
        
        .breakpoint-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.2rem 0.4rem;
            border-radius: 2px;
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .schema-viewer {
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            background: #f9fafb;
            border-radius: 4px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .node-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .node-item:hover {
            border-color: #3b82f6;
        }
        
        .node-item.current {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .node-item.breakpoint {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .node-type {
            font-size: 0.7rem;
            padding: 0.1rem 0.3rem;
            border-radius: 2px;
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .node-label {
            font-weight: 500;
            color: #1f2937;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-indicator.stopped { background: #6b7280; }
        .status-indicator.running { background: #10b981; }
        .status-indicator.paused { background: #f59e0b; }
        .status-indicator.error { background: #ef4444; }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        
        .success {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="debug-header">
            <h1>üêõ –û—Ç–ª–∞–¥—á–∏–∫ –±–æ—Ç–æ–≤</h1>
            <div class="debug-controls">
                <button class="btn btn-success" id="startBtn" onclick="startDebugging()">‚ñ∂ –ó–∞–ø—É—Å–∫</button>
                <button class="btn btn-warning" id="pauseBtn" onclick="pauseDebugging()" disabled>‚è∏ –ü–∞—É–∑–∞</button>
                <button class="btn" id="stepBtn" onclick="stepDebugging()" disabled>‚è≠ –®–∞–≥</button>
                <button class="btn btn-danger" id="stopBtn" onclick="stopDebugging()" disabled>‚èπ –°—Ç–æ–ø</button>
            </div>
        </div>
        
        <div class="debug-sidebar">
            <div class="panel">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–∏</h2>
                
                <div class="bot-selector">
                    <input type="text" id="botIdInput" placeholder="ID –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏">
                    <button class="btn" onclick="createSession()" style="margin-top: 0.5rem; width: 100%;">–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
                </div>
                
                <div class="session-info" id="sessionInfo">
                    <div><span class="status-indicator stopped"></span>–°–µ—Å—Å–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞</div>
                </div>
            </div>
            
            <div class="panel">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
                <div class="execution-history" id="executionHistory">
                    <div class="loading">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç–ª–∞–¥–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏</div>
                </div>
            </div>
            
            <div class="panel">
                <h2>–¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞</h2>
                <div class="breakpoints-list" id="breakpointsList">
                    <div class="loading">–ù–µ—Ç —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–∞</div>
                </div>
            </div>
        </div>
        
        <div class="debug-main">
            <div class="panel">
                <h2>–°—Ö–µ–º–∞ –±–æ—Ç–∞</h2>
                <div class="schema-viewer" id="schemaViewer">
                    <div class="loading">–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Å—Å–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ö–µ–º—ã</div>
                </div>
            </div>
        </div>
        
        <div class="debug-inspector">
            <div class="panel">
                <h2>–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</h2>
                <div class="variables-list" id="variablesList">
                    <div class="loading">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentBotId = null;
        let debugStatus = 'stopped';
        let updateInterval = null;
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –æ—Ç–ª–∞–¥–∫–∏
        async function createSession() {
            const botId = document.getElementById('botIdInput').value.trim();
            if (!botId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –±–æ—Ç–∞');
                return;
            }
            
            try {
                const response = await fetch('/api/debug/session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        botId: botId,
                        userId: 'debug_user'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentBotId = botId;
                    updateSessionInfo();
                    loadBotSchema();
                    startStatusUpdates();
                    showSuccess('–°–µ—Å—Å–∏—è –æ—Ç–ª–∞–¥–∫–∏ —Å–æ–∑–¥–∞–Ω–∞');
                } else {
                    showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏: ' + data.error);
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏: ' + error.message);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –æ—Ç–ª–∞–¥–∫–∏
        async function startDebugging() {
            if (!currentBotId) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Å—Å–∏—é');
                return;
            }
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputData: {
                            message_text: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏',
                            user_id: 'debug_user_123'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    debugStatus = data.status;
                    updateControls();
                    updateSessionInfo();
                } else {
                    showError('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + data.error);
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + error.message);
            }
        }
        
        // –ü–∞—É–∑–∞ –æ—Ç–ª–∞–¥–∫–∏
        async function pauseDebugging() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/pause`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    debugStatus = data.status;
                    updateControls();
                    updateSessionInfo();
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–∞—É–∑—ã: ' + error.message);
            }
        }
        
        // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏
        async function resumeDebugging() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/resume`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    debugStatus = data.status;
                    updateControls();
                    updateSessionInfo();
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è: ' + error.message);
            }
        }
        
        // –ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        async function stepDebugging() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/step`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    debugStatus = data.status;
                    updateControls();
                    updateSessionInfo();
                    updateVariables();
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —à–∞–≥–∞: ' + error.message);
            }
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–ª–∞–¥–∫–∏
        async function stopDebugging() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/stop`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    debugStatus = data.status;
                    updateControls();
                    updateSessionInfo();
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + error.message);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Å—Å–∏–∏
        async function updateSessionInfo() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/status`);
                const data = await response.json();
                
                if (data.success && data.exists) {
                    const sessionInfo = document.getElementById('sessionInfo');
                    sessionInfo.className = `session-info ${data.status}`;
                    
                    const statusText = {
                        'stopped': '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞',
                        'running': '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è',
                        'paused': '–ù–∞ –ø–∞—É–∑–µ',
                        'error': '–û—à–∏–±–∫–∞'
                    }[data.status] || data.status;
                    
                    sessionInfo.innerHTML = `
                        <div><span class="status-indicator ${data.status}"></span>${statusText}</div>
                        <div>–ë–æ—Ç: ${currentBotId}</div>
                        <div>–¢–µ–∫—É—â–∏–π —É–∑–µ–ª: ${data.currentNode || '–ù–µ—Ç'}</div>
                        <div>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${data.executionTime || 0}–º—Å</div>
                        <div>–®–∞–≥–æ–≤: ${data.stepCount || 0}</div>
                    `;
                    
                    debugStatus = data.status;
                    updateControls();
                    
                    if (data.executionHistory) {
                        updateExecutionHistory(data.executionHistory);
                    }
                    
                    if (data.variables) {
                        displayVariables(data.variables);
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        async function updateVariables() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/debug/${currentBotId}/variables`);
                const data = await response.json();
                
                if (data.success) {
                    displayVariables(data.variables);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:', error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        function displayVariables(variables) {
            const variablesList = document.getElementById('variablesList');
            
            if (!variables || Object.keys(variables).length === 0) {
                variablesList.innerHTML = '<div class="loading">–ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö</div>';
                return;
            }
            
            const variablesHtml = Object.entries(variables).map(([name, value]) => {
                const valueType = typeof value;
                const displayValue = String(value).length > 20 ? 
                    String(value).substring(0, 20) + '...' : 
                    String(value);
                
                return `
                    <div class="variable-item">
                        <div class="variable-name">${name}</div>
                        <div class="variable-value ${valueType}">${displayValue}</div>
                    </div>
                `;
            }).join('');
            
            variablesList.innerHTML = variablesHtml;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        function updateExecutionHistory(history) {
            const historyContainer = document.getElementById('executionHistory');
            
            if (!history || history.length === 0) {
                historyContainer.innerHTML = '<div class="loading">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            const historyHtml = history.map((step, index) => {
                const timestamp = new Date(step.timestamp).toLocaleTimeString();
                const isCurrent = index === history.length - 1;
                
                return `
                    <div class="history-item ${isCurrent ? 'current' : ''}">
                        <div class="step-number">–®–∞–≥ ${step.stepNumber}</div>
                        <div class="node-label">${step.nodeLabel}</div>
                        <div class="timestamp">${timestamp}</div>
                    </div>
                `;
            }).join('');
            
            historyContainer.innerHTML = historyHtml;
            historyContainer.scrollTop = historyContainer.scrollHeight;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –±–æ—Ç–∞
        async function loadBotSchema() {
            if (!currentBotId) return;
            
            try {
                const response = await fetch(`/api/bots/${currentBotId}`);
                const data = await response.json();
                
                if (data.success || data.data) {
                    const botData = data.data || data;
                    displayBotSchema(botData);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º—ã:', error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–æ—Ç–∞
        function displayBotSchema(botData) {
            const schemaViewer = document.getElementById('schemaViewer');
            const nodes = botData.configuration?.nodes || [];
            
            if (nodes.length === 0) {
                schemaViewer.innerHTML = '<div class="loading">–°—Ö–µ–º–∞ –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            const nodesHtml = nodes.map(node => {
                return `
                    <div class="node-item" data-node-id="${node.id}" onclick="toggleBreakpoint('${node.id}')">
                        <div class="node-header">
                            <div class="node-type">${node.type}</div>
                        </div>
                        <div class="node-label">${node.data?.label || node.id}</div>
                    </div>
                `;
            }).join('');
            
            schemaViewer.innerHTML = nodesHtml;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞
        async function toggleBreakpoint(nodeId) {
            if (!currentBotId) return;
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞
                const nodeElement = document.querySelector(`[data-node-id="${nodeId}"]`);
                const hasBreakpoint = nodeElement.classList.contains('breakpoint');
                
                if (hasBreakpoint) {
                    // –£–¥–∞–ª—è–µ–º —Ç–æ—á–∫—É –æ—Å—Ç–∞–Ω–æ–≤–∞
                    const response = await fetch(`/api/debug/${currentBotId}/breakpoint/${nodeId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        nodeElement.classList.remove('breakpoint');
                    }
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –æ—Å—Ç–∞–Ω–æ–≤–∞
                    const response = await fetch(`/api/debug/${currentBotId}/breakpoint`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ nodeId })
                    });
                    
                    if (response.ok) {
                        nodeElement.classList.add('breakpoint');
                    }
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∞: ' + error.message);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function updateControls() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stepBtn = document.getElementById('stepBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            switch (debugStatus) {
                case 'stopped':
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stepBtn.disabled = true;
                    stopBtn.disabled = true;
                    pauseBtn.textContent = '‚è∏ –ü–∞—É–∑–∞';
                    pauseBtn.onclick = pauseDebugging;
                    break;
                    
                case 'running':
                    startBtn.disabled = true;
                    pauseBtn.disabled = false;
                    stepBtn.disabled = true;
                    stopBtn.disabled = false;
                    pauseBtn.textContent = '‚è∏ –ü–∞—É–∑–∞';
                    pauseBtn.onclick = pauseDebugging;
                    break;
                    
                case 'paused':
                    startBtn.disabled = true;
                    pauseBtn.disabled = false;
                    stepBtn.disabled = false;
                    stopBtn.disabled = false;
                    pauseBtn.textContent = '‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                    pauseBtn.onclick = resumeDebugging;
                    break;
                    
                case 'error':
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stepBtn.disabled = true;
                    stopBtn.disabled = false;
                    break;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function startStatusUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            updateInterval = setInterval(() => {
                if (currentBotId && (debugStatus === 'running' || debugStatus === 'paused')) {
                    updateSessionInfo();
                }
            }, 1000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                document.body.removeChild(errorDiv);
            }, 5000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                document.body.removeChild(successDiv);
            }, 3000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateControls();
        });
    </script>
</body>
</html>