<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ –¢–µ—Å—Ç React —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
            background: #fafafa;
        }
        .success { color: #22c55e; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .link-button {
            background: #10b981;
            text-decoration: none;
            display: inline-block;
        }
        .link-button:hover {
            background: #059669;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h1 { color: #1f2937; }
        h2 { color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –¢–µ—Å—Ç React —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±–æ—Ç–æ–≤</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.</p>
        
        <div class="test-section">
            <h2>üîó –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏</h2>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç–∏ —Å—Å—ã–ª–∫–∏ –≤ –Ω–æ–≤—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö:</p>
            <a href="/editor/01_main_test_bot" target="_blank" class="link-button">
                –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
            </a>
            <a href="/editor/test_visual_editor" target="_blank" class="link-button">
                –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
            </a>
            <a href="/" target="_blank" class="link-button">
                –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            </a>
        </div>

        <div class="test-section">
            <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</h2>
            <div id="bot-info">
                <button onclick="loadBotInfo()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üñºÔ∏è –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</h2>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä—è–º–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</p>
            <button onclick="loadEditor()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ iframe</button>
            <div id="editor-container"></div>
        </div>

        <div class="test-section">
            <h2>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
            <button onclick="runDiagnostics()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            <div id="diagnostics-result"></div>
        </div>
    </div>

    <script>
        async function loadBotInfo() {
            const container = document.getElementById('bot-info');
            container.innerHTML = '<div style="color: #6b7280;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                const response = await fetch('/api/bots/01_main_test_bot');
                const result = await response.json();
                
                if (response.ok) {
                    const bot = result.success ? result.data : result;
                    container.innerHTML = `
                        <div class="success">‚úÖ –ë–æ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ</div>
                        <div><strong>ID:</strong> ${bot.id}</div>
                        <div><strong>–ò–º—è:</strong> ${bot.name}</div>
                        <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${bot.status}</div>
                        <div><strong>–£–∑–ª–æ–≤ –≤ —Å—Ö–µ–º–µ:</strong> ${bot.configuration?.nodes?.length || 0}</div>
                        <div><strong>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–π:</strong> ${bot.configuration?.connections?.length || 0}</div>
                        <div><strong>–¢–æ–∫–µ–Ω:</strong> ${bot.token ? bot.token.substring(0, 10) + '...' : '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
                    `;
                } else {
                    container.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${response.status}</div>`;
                }
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        function loadEditor() {
            const container = document.getElementById('editor-container');
            container.innerHTML = `
                <iframe src="/editor/01_main_test_bot" 
                        onload="onEditorLoad()" 
                        onerror="onEditorError()">
                </iframe>
            `;
        }

        function onEditorLoad() {
            console.log('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω –≤ iframe');
        }

        function onEditorError() {
            console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ iframe');
        }

        async function runDiagnostics() {
            const container = document.getElementById('diagnostics-result');
            container.innerHTML = '<div style="color: #6b7280;">‚è≥ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...</div>';
            
            const results = [];
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ API
            try {
                const apiResponse = await fetch('/api/bots');
                results.push({
                    test: 'API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
                    status: apiResponse.ok ? 'ok' : 'error',
                    message: apiResponse.ok ? 'API —Ä–∞–±–æ—Ç–∞–µ—Ç' : `–û—à–∏–±–∫–∞ ${apiResponse.status}`
                });
            } catch (error) {
                results.push({
                    test: 'API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
                    status: 'error',
                    message: error.message
                });
            }

            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try {
                const mainResponse = await fetch('/');
                const html = await mainResponse.text();
                const hasReact = html.includes('react') || html.includes('id="root"') || html.includes('id="app"');
                results.push({
                    test: 'React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                    status: hasReact ? 'ok' : 'warning',
                    message: hasReact ? 'React —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã' : 'React —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'
                });
            } catch (error) {
                results.push({
                    test: 'React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                    status: 'error',
                    message: error.message
                });
            }

            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            try {
                const editorResponse = await fetch('/editor/01_main_test_bot');
                results.push({
                    test: '–†–µ–¥–∞–∫—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
                    status: editorResponse.ok ? 'ok' : 'error',
                    message: editorResponse.ok ? '–†–µ–¥–∞–∫—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω' : `–û—à–∏–±–∫–∞ ${editorResponse.status}`
                });
            } catch (error) {
                results.push({
                    test: '–†–µ–¥–∞–∫—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
                    status: 'error',
                    message: error.message
                });
            }

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const resultHtml = results.map(result => {
                const statusClass = result.status === 'ok' ? 'success' : 
                                  result.status === 'warning' ? 'warning' : 'error';
                const icon = result.status === 'ok' ? '‚úÖ' : 
                           result.status === 'warning' ? '‚ö†Ô∏è' : '‚ùå';
                return `<div class="${statusClass}">${icon} ${result.test}: ${result.message}</div>`;
            }).join('');

            container.innerHTML = `
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:</h3>
                ${resultHtml}
                <div style="margin-top: 15px;">
                    <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong>
                    <ul>
                        <li>–ï—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä</li>
                        <li>–ï—Å–ª–∏ React –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–±–µ—Ä–∏—Ç–µ frontend: <code>cd frontend && npm run build</code></li>
                        <li>–ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ—É—Ç–∏–Ω–≥ –≤ server.js</li>
                    </ul>
                </div>
            `;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            console.log('üìã –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            loadBotInfo();
        });
    </script>
</body>
</html>