<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Constructor</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-section {
            margin: 20px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        .test-button {
            margin: 10px;
            padding: 15px 25px;
            font-size: 16px;
            cursor: pointer;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div id="status" class="status info">
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
    </div>

    <div class="app-container">
        <div id="dashboard-view" class="view active">
            <header class="dashboard-header">
                <h1>ü§ñ Bot Constructor</h1>
                <p>–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏</p>
            </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ü§ñ</div>
                <div class="stat-content">
                    <div class="stat-number" id="totalBots">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –±–æ—Ç–æ–≤</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-number" id="activeBots">0</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí¨</div>
                <div class="stat-content">
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-content">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
            </div>
        </div>

        <div class="bots-section">
            <div class="section-header">
                <h2>üìã –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤</h2>
                <button class="btn btn-primary" onclick="createNewBot()">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
                </button>
            </div>
            <div id="botsContainer" class="bots-grid">
                <div class="loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –±–æ—Ç–æ–≤...</div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ -->
    <div id="constructor-view" class="view">
        <header class="constructor-header">
            <button class="btn btn-secondary" onclick="backToDashboard()">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </button>
            <div class="current-bot-info">
                <h2 id="constructorBotName">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–∞</h2>
                <span id="constructorBotStatus" class="bot-status"></span>
            </div>
            <div class="constructor-actions">
                <button class="btn btn-info" onclick="showGeneratedCode()">üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥</button>
                <button class="btn btn-primary" onclick="validateCurrentSchema()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="btn btn-success" onclick="saveBotSchema()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-warning" onclick="testBot()">‚ñ∂Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </header>

        <div class="constructor-workspace">
            <div class="left-panel">
                <h3>üß© –£–∑–ª—ã</h3>
                <div class="node-categories">
                    <div class="node-category">
                        <h4>üì® –¢—Ä–∏–≥–≥–µ—Ä—ã</h4>
                        <div class="node-item" draggable="true" data-type="start">
                            <span class="node-icon">üöÄ</span>
                            <span>–°—Ç–∞—Ä—Ç</span>
                        </div>
                        <div class="node-item" draggable="true" data-type="command">
                            <span class="node-icon">‚ö°</span>
                            <span>–ö–æ–º–∞–Ω–¥–∞</span>
                        </div>
                        <div class="node-item" draggable="true" data-type="text">
                            <span class="node-icon">üí¨</span>
                            <span>–¢–µ–∫—Å—Ç</span>
                        </div>
                    </div>
                    
                    <div class="node-category">
                        <h4>üéØ –î–µ–π—Å—Ç–≤–∏—è</h4>
                        <div class="node-item" draggable="true" data-type="message">
                            <span class="node-icon">üì§</span>
                            <span>–°–æ–æ–±—â–µ–Ω–∏–µ</span>
                        </div>
                        <div class="node-item" draggable="true" data-type="keyboard">
                            <span class="node-icon">‚å®Ô∏è</span>
                            <span>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</span>
                        </div>
                        <div class="node-item" draggable="true" data-type="photo">
                            <span class="node-icon">üñºÔ∏è</span>
                            <span>–§–æ—Ç–æ</span>
                        </div>
                    </div>
                    
                    <div class="node-category">
                        <h4>üîÄ –õ–æ–≥–∏–∫–∞</h4>
                        <div class="node-item" draggable="true" data-type="condition">
                            <span class="node-icon">‚ùì</span>
                            <span>–£—Å–ª–æ–≤–∏–µ</span>
                        </div>
                        <div class="node-item" draggable="true" data-type="delay">
                            <span class="node-icon">‚è±Ô∏è</span>
                            <span>–ó–∞–¥–µ—Ä–∂–∫–∞</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="center-panel">
                <div class="canvas-container">
                    <canvas id="editorCanvas" width="800" height="600"></canvas>
                </div>
            </div>

            <div class="right-panel">
                <div class="panel-tabs">
                    <button class="tab-btn active" onclick="showTab('properties')">‚öôÔ∏è –°–≤–æ–π—Å—Ç–≤–∞</button>
                    <button class="tab-btn" onclick="showTab('code')">üìÑ –ö–æ–¥</button>
                </div>
                
                <div id="properties-tab" class="tab-content active">
                    <div id="propertiesPanel">
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                    </div>
                </div>
                
                <div id="code-tab" class="tab-content">
                    <div class="code-header">
                        <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥</h4>
                        <button class="btn btn-sm" onclick="copyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <pre id="generatedCode" class="code-block">
// –ö–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã –±–æ—Ç–∞
                    </pre>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="codeModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –±–æ—Ç–∞</h3>
                <span class="close" onclick="closeCodeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="code-tabs">
                    <button class="code-tab-btn active" onclick="showCodeTab('main')">main.js</button>
                    <button class="code-tab-btn" onclick="showCodeTab('handlers')">handlers.js</button>
                    <button class="code-tab-btn" onclick="showCodeTab('config')">config.json</button>
                </div>
                <pre id="fullGeneratedCode" class="code-block large"></pre>
                <div class="code-actions">
                    <button class="btn btn-primary" onclick="downloadCode()">üíæ –°–∫–∞—á–∞—Ç—å</button>
                    <button class="btn btn-secondary" onclick="copyFullCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateInfo() {
            const info = document.getElementById('info');
            info.innerHTML = `
                <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π:</strong><br>
                ‚Ä¢ createNewBot: ${typeof window.createNewBot}<br>
                ‚Ä¢ backToDashboard: ${typeof window.backToDashboard}<br>
                ‚Ä¢ editBot: ${typeof window.editBot}<br>
                ‚Ä¢ BotConstructor: ${typeof window.BotConstructor}<br>
                ‚Ä¢ botConstructor: ${typeof window.botConstructor}<br>
                ‚Ä¢ VisualEditor: ${typeof window.VisualEditor}<br>
                <br>
                <strong>DOM —ç–ª–µ–º–µ–Ω—Ç—ã:</strong><br>
                ‚Ä¢ dashboard-view: ${document.getElementById('dashboard-view') ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}<br>
                ‚Ä¢ constructor-view: ${document.getElementById('constructor-view') ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}<br>
            `;
        }
        
        function testCreateNewBot() {
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ createNewBot...', 'info');
            try {
                if (typeof window.createNewBot === 'function') {
                    window.createNewBot();
                    updateStatus('‚úÖ createNewBot –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    updateStatus('‚ùå createNewBot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                }
            } catch (e) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –≤ createNewBot: ${e.message}`, 'error');
            }
        }
        
        function testBackToDashboard() {
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backToDashboard...', 'info');
            try {
                if (typeof window.backToDashboard === 'function') {
                    window.backToDashboard();
                    updateStatus('‚úÖ backToDashboard –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    updateStatus('‚ùå backToDashboard –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                }
            } catch (e) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –≤ backToDashboard: ${e.message}`, 'error');
            }
        }
        
        function testEditBot(botId) {
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ editBot...', 'info');
            try {
                if (typeof window.editBot === 'function') {
                    window.editBot(botId);
                    updateStatus('‚úÖ editBot –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    updateStatus('‚ùå editBot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                }
            } catch (e) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –≤ editBot: ${e.message}`, 'error');
            }
        }
        
        function showDashboard() {
            const dashboard = document.getElementById('dashboard-view');
            const constructor = document.getElementById('constructor-view');
            
            if (dashboard && constructor) {
                dashboard.style.display = 'block';
                constructor.style.display = 'none';
                updateStatus('‚úÖ –î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑–∞–Ω', 'success');
            } else {
                updateStatus('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
            }
        }
        
        function showConstructor() {
            const dashboard = document.getElementById('dashboard-view');
            const constructor = document.getElementById('constructor-view');
            
            if (dashboard && constructor) {
                dashboard.style.display = 'none';
                constructor.style.display = 'block';
                updateStatus('‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–∫–∞–∑–∞–Ω', 'success');
            } else {
                updateStatus('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–∂–∏–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤...', 'info');
            updateInfo();
            
            setTimeout(() => {
                updateInfo();
                if (typeof window.createNewBot === 'function') {
                    updateStatus('‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    updateStatus('‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'error');
                }
            }, 2000);
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateInfo, 3000);
    </script>
    
    <!-- –°–Ω–∞—á–∞–ª–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Å –∫–ª–∞—Å—Å–æ–º BotConstructor -->
    <script src="app.js"></script>
    
    <!-- –ü–æ—Ç–æ–º —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ª–∞–¥–∫–∏ -->
    <script src="js/EditorDebugger.js"></script>
    
    <!-- –ó–∞—Ç–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="js/BotConstructorManager.js"></script>
    
    <!-- –†—É—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            console.log('BotConstructor class:', typeof BotConstructor);
            console.log('editorDebugger:', !!window.editorDebugger);
            console.log('botConstructorManager:', !!window.botConstructorManager);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            if (window.botConstructorManager) {
                window.botConstructorManager.initialize()
                    .then(() => console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞'))
                    .catch(error => console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error));
            } else {
                console.error('‚ùå BotConstructorManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        });
    </script>
</body>
</html>