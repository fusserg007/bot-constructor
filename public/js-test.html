<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .warning { background-color: #fff3cd; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß JavaScript Files Test</h1>
    
    <div class="test">
        <h3>1. –ó–∞–≥—Ä—É–∑–∫–∞ app.js</h3>
        <div id="app-js-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>
    
    <div class="test">
        <h3>2. –ó–∞–≥—Ä—É–∑–∫–∞ VisualEditor.js</h3>
        <div id="visual-editor-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>
    
    <div class="test">
        <h3>3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–æ–≤</h3>
        <div id="classes-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>
    
    <div class="test">
        <h3>4. JavaScript –æ—à–∏–±–∫–∏</h3>
        <div id="errors-result">–ù–µ—Ç –æ—à–∏–±–æ–∫</div>
    </div>
    
    <div class="test">
        <h3>5. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
        <div id="globals-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>

    <div class="test">
        <h3>6. –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫</h3>
        <pre id="error-details"></pre>
    </div>

    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
        const errors = [];
        const originalError = console.error;
        const originalLog = console.log;
        
        console.error = function(...args) {
            errors.push({type: 'error', message: args.join(' '), stack: new Error().stack});
            originalError.apply(console, args);
            updateErrors();
        };
        
        window.addEventListener('error', (e) => {
            errors.push({
                type: 'error',
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                stack: e.error ? e.error.stack : 'No stack'
            });
            updateErrors();
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            errors.push({
                type: 'promise',
                message: e.reason,
                stack: e.reason && e.reason.stack ? e.reason.stack : 'No stack'
            });
            updateErrors();
        });
        
        function updateErrors() {
            const errorsDiv = document.getElementById('errors-result');
            const detailsDiv = document.getElementById('error-details');
            
            if (errors.length > 0) {
                errorsDiv.innerHTML = errors.map(err => 
                    `‚ùå ${err.type}: ${err.message} ${err.filename ? `–≤ ${err.filename}:${err.lineno}` : ''}`
                ).join('<br>');
                errorsDiv.parentElement.classList.add('error');
                
                detailsDiv.textContent = errors.map(err => 
                    `${err.type.toUpperCase()}: ${err.message}\n${err.stack || 'No stack'}\n\n`
                ).join('');
            } else {
                errorsDiv.innerHTML = '‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                errorsDiv.parentElement.classList.add('success');
            }
        }
        
        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function testFileLoad(url, resultId) {
            fetch(url)
                .then(response => {
                    const div = document.getElementById(resultId);
                    if (response.ok) {
                        div.innerHTML = `‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω (${response.headers.get('content-length')} –±–∞–π—Ç)`;
                        div.parentElement.classList.add('success');
                    } else {
                        div.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`;
                        div.parentElement.classList.add('error');
                    }
                })
                .catch(error => {
                    const div = document.getElementById(resultId);
                    div.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                    div.parentElement.classList.add('error');
                });
        }
        
        testFileLoad('/app.js', 'app-js-result');
        testFileLoad('/js/VisualEditor.js', 'visual-editor-result');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        setTimeout(() => {
            // –¢–µ—Å—Ç –∫–ª–∞—Å—Å–æ–≤
            const classesDiv = document.getElementById('classes-result');
            const classTests = [];
            
            if (typeof BotConstructor !== 'undefined') {
                classTests.push('‚úÖ BotConstructor –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω');
            } else {
                classTests.push('‚ùå BotConstructor –∫–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            if (typeof VisualEditor !== 'undefined') {
                classTests.push('‚úÖ VisualEditor –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω');
            } else {
                classTests.push('‚ùå VisualEditor –∫–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            classesDiv.innerHTML = classTests.join('<br>');
            if (classTests.some(t => t.includes('‚ùå'))) {
                classesDiv.parentElement.classList.add('error');
            } else {
                classesDiv.parentElement.classList.add('success');
            }
            
            // –¢–µ—Å—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
            const globalsDiv = document.getElementById('globals-result');
            const globalTests = [];
            
            const expectedGlobals = ['backToDashboard', 'editBot', 'createNewBot', 'saveBotSchema'];
            expectedGlobals.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    globalTests.push(`‚úÖ ${funcName} —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞`);
                } else {
                    globalTests.push(`‚ùå ${funcName} —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                }
            });
            
            globalsDiv.innerHTML = globalTests.join('<br>');
            if (globalTests.some(t => t.includes('‚ùå'))) {
                globalsDiv.parentElement.classList.add('error');
            } else {
                globalsDiv.parentElement.classList.add('success');
            }
            
            updateErrors();
        }, 2000);
    </script>
    
    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º JavaScript —Ñ–∞–π–ª—ã -->
    <script src="/js/VisualEditor.js"></script>
    <script src="/app.js"></script>
</body>
</html>