import{r as y,a as me,b as X,s as we,z as Se,R as d,P as he,c as J,i as Te,p as je,g as $e,d as K,e as De,f as Re,h as Me,j as a,H as F,k as U,l as Le,u as Pe,m as Ae,n as ke,o as Oe,L as Be,q as He}from"./index.vm-xfpPs.js";const pe=({id:n,x:e,y:s,width:t,height:o,style:i,color:r,strokeColor:c,strokeWidth:l,className:_,borderRadius:N,shapeRendering:w,onClick:C,selected:f})=>{const{background:x,backgroundColor:v}=i||{},j=r||x||v;return d.createElement("rect",{className:J(["react-flow__minimap-node",{selected:f},_]),x:e,y:s,rx:N,ry:N,width:t,height:o,fill:j,stroke:c,strokeWidth:l,shapeRendering:w,onClick:C?b=>C(b,n):void 0})};pe.displayName="MiniMapNode";var Ve=y.memo(pe);const Ge=n=>n.nodeOrigin,ze=n=>n.getNodes().filter(e=>!e.hidden&&e.width&&e.height),oe=n=>n instanceof Function?n:()=>n;function We({nodeStrokeColor:n="transparent",nodeColor:e="#e2e2e2",nodeClassName:s="",nodeBorderRadius:t=5,nodeStrokeWidth:o=2,nodeComponent:i=Ve,onClick:r}){const c=X(ze,K),l=X(Ge),_=oe(e),N=oe(n),w=oe(s),C=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return d.createElement(d.Fragment,null,c.map(f=>{const{x,y:v}=$e(f,l).positionAbsolute;return d.createElement(i,{key:f.id,x,y:v,width:f.width,height:f.height,style:f.style,selected:f.selected,className:w(f),color:_(f),borderRadius:t,strokeColor:N(f),strokeWidth:o,shapeRendering:C,onClick:r,id:f.id})}))}var Fe=y.memo(We);const Ue=200,qe=150,Ye=n=>{const e=n.getNodes(),s={x:-n.transform[0]/n.transform[2],y:-n.transform[1]/n.transform[2],width:n.width/n.transform[2],height:n.height/n.transform[2]};return{viewBB:s,boundingRect:e.length>0?De(Re(e,n.nodeOrigin),s):s,rfId:n.rfId}},Ze="react-flow__minimap-desc";function _e({style:n,className:e,nodeStrokeColor:s="transparent",nodeColor:t="#e2e2e2",nodeClassName:o="",nodeBorderRadius:i=5,nodeStrokeWidth:r=2,nodeComponent:c,maskColor:l="rgb(240, 240, 240, 0.6)",maskStrokeColor:_="none",maskStrokeWidth:N=1,position:w="bottom-right",onClick:C,onNodeClick:f,pannable:x=!1,zoomable:v=!1,ariaLabel:j="React Flow mini map",inversePan:b=!1,zoomStep:S=10,offsetScale:L=5}){const $=me(),B=y.useRef(null),{boundingRect:D,viewBB:R,rfId:q}=X(Ye,K),m=n?.width??Ue,p=n?.height??qe,E=D.width/m,h=D.height/p,P=Math.max(E,h),V=P*m,ne=P*p,A=L*P,se=D.x-(V-D.width)/2-A,ie=D.y-(ne-D.height)/2-A,Q=V+A*2,re=ne+A*2,le=`${Ze}-${q}`,ce=y.useRef(0);ce.current=P,y.useEffect(()=>{if(B.current){const H=we(B.current),G=k=>{const{transform:z,d3Selection:Y,d3Zoom:W}=$.getState();if(k.sourceEvent.type!=="wheel"||!Y||!W)return;const te=-k.sourceEvent.deltaY*(k.sourceEvent.deltaMode===1?.05:k.sourceEvent.deltaMode?1:.002)*S,ae=z[2]*Math.pow(2,te);W.scaleTo(Y,ae)},ee=k=>{const{transform:z,d3Selection:Y,d3Zoom:W,translateExtent:te,width:ae,height:be}=$.getState();if(k.sourceEvent.type!=="mousemove"||!Y||!W)return;const de=ce.current*Math.max(1,z[2])*(b?-1:1),ue={x:z[0]-k.sourceEvent.movementX*de,y:z[1]-k.sourceEvent.movementY*de},Ee=[[0,0],[ae,be]],xe=Te.translate(ue.x,ue.y).scale(z[2]),Ie=W.constrain()(xe,Ee,te);W.transform(Y,Ie)},Ce=Se().on("zoom",x?ee:null).on("zoom.wheel",v?G:null);return H.call(Ce),()=>{H.on("zoom",null)}}},[x,v,b,S]);const Ne=C?H=>{const G=je(H);C(H,{x:G[0],y:G[1]})}:void 0,ve=f?(H,G)=>{const ee=$.getState().nodeInternals.get(G);f(H,ee)}:void 0;return d.createElement(he,{position:w,style:n,className:J(["react-flow__minimap",e]),"data-testid":"rf__minimap"},d.createElement("svg",{width:m,height:p,viewBox:`${se} ${ie} ${Q} ${re}`,role:"img","aria-labelledby":le,ref:B,onClick:Ne},j&&d.createElement("title",{id:le},j),d.createElement(Fe,{onClick:ve,nodeColor:t,nodeStrokeColor:s,nodeBorderRadius:i,nodeClassName:o,nodeStrokeWidth:r,nodeComponent:c}),d.createElement("path",{className:"react-flow__minimap-mask",d:`M${se-A},${ie-A}h${Q+A*2}v${re+A*2}h${-Q-A*2}z
        M${R.x},${R.y}h${R.width}v${R.height}h${-R.width}z`,fill:l,fillRule:"evenodd",stroke:_,strokeWidth:N,pointerEvents:"none"})))}_e.displayName="MiniMap";var Xe=y.memo(_e);function Je(){return d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},d.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function Ke(){return d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},d.createElement("path",{d:"M0 0h32v4.2H0z"}))}function Qe(){return d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},d.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function et(){return d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},d.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function tt(){return d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},d.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Z=({children:n,className:e,...s})=>d.createElement("button",{type:"button",className:J(["react-flow__controls-button",e]),...s},n);Z.displayName="ControlButton";const at=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),fe=({style:n,showZoom:e=!0,showFitView:s=!0,showInteractive:t=!0,fitViewOptions:o,onZoomIn:i,onZoomOut:r,onFitView:c,onInteractiveChange:l,className:_,children:N,position:w="bottom-left"})=>{const C=me(),[f,x]=y.useState(!1),{isInteractive:v,minZoomReached:j,maxZoomReached:b}=X(at,K),{zoomIn:S,zoomOut:L,fitView:$}=Me();if(y.useEffect(()=>{x(!0)},[]),!f)return null;const B=()=>{S(),i?.()},D=()=>{L(),r?.()},R=()=>{$(o),c?.()},q=()=>{C.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),l?.(!v)};return d.createElement(he,{className:J(["react-flow__controls",_]),position:w,style:n,"data-testid":"rf__controls"},e&&d.createElement(d.Fragment,null,d.createElement(Z,{onClick:B,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:b},d.createElement(Je,null)),d.createElement(Z,{onClick:D,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:j},d.createElement(Ke,null))),s&&d.createElement(Z,{className:"react-flow__controls-fitview",onClick:R,title:"fit view","aria-label":"fit view"},d.createElement(Qe,null)),t&&d.createElement(Z,{className:"react-flow__controls-interactive",onClick:q,title:"toggle interactivity","aria-label":"toggle interactivity"},v?d.createElement(tt,null):d.createElement(et,null)),N)};fe.displayName="Controls";var ot=y.memo(fe),T;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(T||(T={}));function nt({color:n,dimensions:e,lineWidth:s}){return d.createElement("path",{stroke:n,strokeWidth:s,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function st({color:n,radius:e}){return d.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const it={[T.Dots]:"#91919a",[T.Lines]:"#eee",[T.Cross]:"#e2e2e2"},rt={[T.Dots]:1,[T.Lines]:1,[T.Cross]:6},lt=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function ye({id:n,variant:e=T.Dots,gap:s=20,size:t,lineWidth:o=1,offset:i=2,color:r,style:c,className:l}){const _=y.useRef(null),{transform:N,patternId:w}=X(lt,K),C=r||it[e],f=t||rt[e],x=e===T.Dots,v=e===T.Cross,j=Array.isArray(s)?s:[s,s],b=[j[0]*N[2]||1,j[1]*N[2]||1],S=f*N[2],L=v?[S,S]:b,$=x?[S/i,S/i]:[L[0]/i,L[1]/i];return d.createElement("svg",{className:J(["react-flow__background",l]),style:{...c,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:_,"data-testid":"rf__background"},d.createElement("pattern",{id:w+n,x:N[0]%b[0],y:N[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${$[0]},-${$[1]})`},x?d.createElement(st,{color:C,radius:S/i}):d.createElement(nt,{dimensions:L,color:C,lineWidth:o})),d.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${w+n})`}))}ye.displayName="Background";var ct=y.memo(ye);const dt="NodeLibrary-module__nodeLibrary___-ciVx",ut="NodeLibrary-module__header___jccM3",gt="NodeLibrary-module__searchInput___wWeA2",mt="NodeLibrary-module__categories___yLK7M",ht="NodeLibrary-module__categoryButton___ZQ-G-",pt="NodeLibrary-module__active___8vcO0",_t="NodeLibrary-module__categoryIcon___7mP8Z",ft="NodeLibrary-module__categoryName___coyg2",yt="NodeLibrary-module__nodeList___RDHzd",Nt="NodeLibrary-module__nodeItem___uRac3",vt="NodeLibrary-module__nodeIcon___ULXCF",Ct="NodeLibrary-module__nodeInfo___sDURt",bt="NodeLibrary-module__nodeName___w3qem",Et="NodeLibrary-module__nodeDescription___S80UC",I={nodeLibrary:dt,header:ut,searchInput:gt,categories:mt,categoryButton:ht,active:pt,categoryIcon:_t,categoryName:ft,nodeList:yt,nodeItem:Nt,nodeIcon:vt,nodeInfo:Ct,nodeName:bt,nodeDescription:Et},xt=[{type:"trigger-message",category:"triggers",name:"–°–æ–æ–±—â–µ–Ω–∏–µ",description:"–†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è",icon:"üì®",color:"#3b82f6",defaultConfig:{messageType:"text",filters:[]},inputs:[],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"trigger-command",category:"triggers",name:"–ö–æ–º–∞–Ω–¥–∞",description:"–†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã (/start, /help)",icon:"‚ö°",color:"#3b82f6",defaultConfig:{command:"/start"},inputs:[],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"action-send-message",category:"actions",name:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",description:"–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",icon:"üí¨",color:"#10b981",defaultConfig:{message:"–ü—Ä–∏–≤–µ—Ç!",parseMode:"HTML"},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"action-send-photo",category:"actions",name:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ",description:"–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",icon:"üñºÔ∏è",color:"#10b981",defaultConfig:{photo:"",caption:""},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"condition-text",category:"conditions",name:"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞",description:"–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è",icon:"üîç",color:"#f59e0b",defaultConfig:{condition:"contains",value:"",caseSensitive:!1},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"true",name:"–î–∞",type:"control",dataType:"any",required:!1,multiple:!1},{id:"false",name:"–ù–µ—Ç",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"condition-user",category:"conditions",name:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",description:"–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",icon:"üë§",color:"#f59e0b",defaultConfig:{checkType:"isAdmin"},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"true",name:"–î–∞",type:"control",dataType:"any",required:!1,multiple:!1},{id:"false",name:"–ù–µ—Ç",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"data-save",category:"data",name:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",description:"–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",icon:"üíæ",color:"#8b5cf6",defaultConfig:{key:"userData",value:""},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]},{type:"data-load",category:"data",name:"–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",description:"–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",icon:"üìÇ",color:"#8b5cf6",defaultConfig:{key:"userData"},inputs:[{id:"input",name:"–í—Ö–æ–¥",type:"control",dataType:"any",required:!0,multiple:!1}],outputs:[{id:"output",name:"–í—ã—Ö–æ–¥",type:"control",dataType:"any",required:!1,multiple:!1}]}],It=[{key:"triggers",name:"–¢—Ä–∏–≥–≥–µ—Ä—ã",icon:"üöÄ"},{key:"actions",name:"–î–µ–π—Å—Ç–≤–∏—è",icon:"‚ö°"},{key:"conditions",name:"–£—Å–ª–æ–≤–∏—è",icon:"‚ùì"},{key:"data",name:"–î–∞–Ω–Ω—ã–µ",icon:"üíæ"},{key:"integrations",name:"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏",icon:"üîó"},{key:"scenarios",name:"–°—Ü–µ–Ω–∞—Ä–∏–∏",icon:"üìã"}],wt=({onNodeAdd:n})=>{const[e,s]=d.useState("triggers"),[t,o]=d.useState(""),i=xt.filter(l=>{const _=l.category===e,N=t===""||l.name.toLowerCase().includes(t.toLowerCase())||l.description.toLowerCase().includes(t.toLowerCase());return _&&N}),r=(l,_)=>{l.dataTransfer.setData("application/reactflow",_),l.dataTransfer.effectAllowed="move"},c=l=>{n&&n(l)};return a.jsxs("div",{className:I.nodeLibrary,children:[a.jsxs("div",{className:I.header,children:[a.jsx("h3",{children:"–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–∑–ª–æ–≤"}),a.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫...",value:t,onChange:l=>o(l.target.value),className:I.searchInput})]}),a.jsx("div",{className:I.categories,children:It.map(l=>a.jsxs("button",{className:`${I.categoryButton} ${e===l.key?I.active:""}`,onClick:()=>s(l.key),children:[a.jsx("span",{className:I.categoryIcon,children:l.icon}),a.jsx("span",{className:I.categoryName,children:l.name})]},l.key))}),a.jsx("div",{className:I.nodeList,children:i.map(l=>a.jsxs("div",{className:I.nodeItem,draggable:!0,onDragStart:_=>r(_,l.type),onClick:()=>c(l.type),children:[a.jsx("div",{className:I.nodeIcon,style:{backgroundColor:l.color},children:l.icon}),a.jsxs("div",{className:I.nodeInfo,children:[a.jsx("div",{className:I.nodeName,children:l.name}),a.jsx("div",{className:I.nodeDescription,children:l.description})]})]},l.type))})]})},St="PropertyPanel-module__propertyPanel___MG-tj",Tt="PropertyPanel-module__header___fHXek",jt="PropertyPanel-module__nodeType___Ig0P-",$t="PropertyPanel-module__content___ezxJC",Dt="PropertyPanel-module__section___vuzpT",Rt="PropertyPanel-module__field___bl-DV",Mt="PropertyPanel-module__label___XbnRD",Lt="PropertyPanel-module__input___sWDaL",Pt="PropertyPanel-module__textarea___-PCaR",At="PropertyPanel-module__disabled___-6hIS",kt="PropertyPanel-module__checkboxLabel___CODJY",Ot="PropertyPanel-module__checkbox___-fJsN",Bt="PropertyPanel-module__positionFields___GkKsC",Ht="PropertyPanel-module__emptyState___qqkDx",Vt="PropertyPanel-module__emptyIcon___WzhBl",u={propertyPanel:St,header:Tt,nodeType:jt,content:$t,section:Dt,field:Rt,label:Mt,input:Lt,textarea:Pt,disabled:At,checkboxLabel:kt,checkbox:Ot,positionFields:Bt,emptyState:Ht,emptyIcon:Vt},Gt=({selectedNode:n,onNodeUpdate:e})=>{const[s,t]=d.useState({});d.useEffect(()=>{n&&t(n.data||{})},[n]);const o=(r,c)=>{const l={...s,[r]:c};t(l),n&&e&&e(n.id,l)};if(!n)return a.jsx("div",{className:u.propertyPanel,children:a.jsxs("div",{className:u.emptyState,children:[a.jsx("div",{className:u.emptyIcon,children:"üéØ"}),a.jsx("h3",{children:"–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª"}),a.jsx("p",{children:"–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞"})]})});const i=(r,c)=>typeof c=="string"?a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:r.charAt(0).toUpperCase()+r.slice(1)}),a.jsx("input",{type:"text",value:c,onChange:l=>o(r,l.target.value),className:u.input})]},r):typeof c=="number"?a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:r.charAt(0).toUpperCase()+r.slice(1)}),a.jsx("input",{type:"number",value:c,onChange:l=>o(r,Number(l.target.value)),className:u.input})]},r):typeof c=="boolean"?a.jsx("div",{className:u.field,children:a.jsxs("label",{className:u.checkboxLabel,children:[a.jsx("input",{type:"checkbox",checked:c,onChange:l=>o(r,l.target.checked),className:u.checkbox}),r.charAt(0).toUpperCase()+r.slice(1)]})},r):Array.isArray(c)?a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:r.charAt(0).toUpperCase()+r.slice(1)}),a.jsx("textarea",{value:c.join(`
`),onChange:l=>o(r,l.target.value.split(`
`).filter(Boolean)),className:u.textarea,rows:3})]},r):null;return a.jsxs("div",{className:u.propertyPanel,children:[a.jsxs("div",{className:u.header,children:[a.jsx("h3",{children:"–°–≤–æ–π—Å—Ç–≤–∞ —É–∑–ª–∞"}),a.jsx("div",{className:u.nodeType,children:n.type})]}),a.jsxs("div",{className:u.content,children:[a.jsxs("div",{className:u.section,children:[a.jsx("h4",{children:"–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"}),a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:"ID —É–∑–ª–∞"}),a.jsx("input",{type:"text",value:n.id,disabled:!0,className:`${u.input} ${u.disabled}`})]}),a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:"–¢–∏–ø —É–∑–ª–∞"}),a.jsx("input",{type:"text",value:n.type,disabled:!0,className:`${u.input} ${u.disabled}`})]}),a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:"–ù–∞–∑–≤–∞–Ω–∏–µ"}),a.jsx("input",{type:"text",value:n.data?.label||"",onChange:r=>o("label",r.target.value),className:u.input})]})]}),Object.keys(s).length>0&&a.jsxs("div",{className:u.section,children:[a.jsx("h4",{children:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"}),Object.entries(s).map(([r,c])=>r==="label"?null:i(r,c))]}),a.jsxs("div",{className:u.section,children:[a.jsx("h4",{children:"–ü–æ–∑–∏—Ü–∏—è"}),a.jsxs("div",{className:u.positionFields,children:[a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:"X"}),a.jsx("input",{type:"number",value:Math.round(n.position.x),disabled:!0,className:`${u.input} ${u.disabled}`})]}),a.jsxs("div",{className:u.field,children:[a.jsx("label",{className:u.label,children:"Y"}),a.jsx("input",{type:"number",value:Math.round(n.position.y),disabled:!0,className:`${u.input} ${u.disabled}`})]})]})]})]})]})},zt="ValidationPanel-module__validationPanel___7n4v8",Wt="ValidationPanel-module__header___u1fw5",Ft="ValidationPanel-module__closeButton___hQT4u",Ut="ValidationPanel-module__validationErrors___urIJX",qt="ValidationPanel-module__validationWarnings___ILUhX",Yt="ValidationPanel-module__nodeId___gfI14",Zt="ValidationPanel-module__connectionId___FzsRj",Xt="ValidationPanel-module__summary___MAMCx",M={validationPanel:zt,header:Wt,closeButton:Ft,validationErrors:Ut,validationWarnings:qt,nodeId:Yt,connectionId:Zt,summary:Xt},Jt=({errors:n,warnings:e,onClose:s})=>n.length===0&&e.length===0?null:a.jsxs("div",{className:M.validationPanel,children:[a.jsxs("div",{className:M.header,children:[a.jsx("h3",{children:"–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã"}),s&&a.jsx("button",{onClick:s,className:M.closeButton,children:"‚úï"})]}),n.length>0&&a.jsxs("div",{className:M.validationErrors,children:[a.jsxs("h4",{children:["‚ùå –û—à–∏–±–∫–∏ (",n.length,")"]}),a.jsx("ul",{children:n.map((t,o)=>a.jsxs("li",{title:`–¢–∏–ø: ${t.type}`,children:[t.message,t.nodeId&&a.jsxs("span",{className:M.nodeId,children:[" (—É–∑–µ–ª: ",t.nodeId,")"]}),t.connectionId&&a.jsxs("span",{className:M.connectionId,children:[" (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ",t.connectionId,")"]})]},o))})]}),e.length>0&&a.jsxs("div",{className:M.validationWarnings,children:[a.jsxs("h4",{children:["‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (",e.length,")"]}),a.jsx("ul",{children:e.map((t,o)=>a.jsxs("li",{title:`–¢–∏–ø: ${t.type}`,children:[t.message,t.nodeId&&a.jsxs("span",{className:M.nodeId,children:[" (—É–∑–µ–ª: ",t.nodeId,")"]}),t.connectionId&&a.jsxs("span",{className:M.connectionId,children:[" (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ",t.connectionId,")"]})]},o))})]}),a.jsx("div",{className:M.summary,children:a.jsxs("small",{children:["–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º: ",n.length+e.length,n.length>0&&" ‚Ä¢ –ï—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏"]})})]}),Kt="CustomNodes-module__customNode___zyDaE",Qt="CustomNodes-module__selected___HmzO4",ea="CustomNodes-module__nodeHeader___N4P5J",ta="CustomNodes-module__nodeIcon___AM283",aa="CustomNodes-module__nodeTitle___fchDi",oa="CustomNodes-module__nodeContent___uxTua",na="CustomNodes-module__nodeLabel___rgjiu",sa="CustomNodes-module__nodeSubtext___ggvLo",ia="CustomNodes-module__handle___7LhlI",ra="CustomNodes-module__triggerNode___0rW1f",la="CustomNodes-module__actionNode___6rjYs",ca="CustomNodes-module__conditionNode___kpt3s",da="CustomNodes-module__conditionOutputs___JQ6AL",ua="CustomNodes-module__outputLabels___BAmo9",ga="CustomNodes-module__outputLabel___mhM2M",ma="CustomNodes-module__trueHandle___4E--c",ha="CustomNodes-module__falseHandle___iE7K4",g={customNode:Kt,selected:Qt,nodeHeader:ea,nodeIcon:ta,nodeTitle:aa,nodeContent:oa,nodeLabel:na,nodeSubtext:sa,handle:ia,triggerNode:ra,actionNode:la,conditionNode:ca,conditionOutputs:da,outputLabels:ua,outputLabel:ga,trueHandle:ma,falseHandle:ha},pa=({data:n,selected:e})=>a.jsxs("div",{className:`${g.customNode} ${g.triggerNode} ${e?g.selected:""}`,children:[a.jsxs("div",{className:g.nodeHeader,style:{backgroundColor:n.color||"#3b82f6"},children:[a.jsx("span",{className:g.nodeIcon,children:n.icon||"üöÄ"}),a.jsx("span",{className:g.nodeTitle,children:"–¢—Ä–∏–≥–≥–µ—Ä"})]}),a.jsxs("div",{className:g.nodeContent,children:[a.jsx("div",{className:g.nodeLabel,children:n.label}),n.triggerType&&a.jsxs("div",{className:g.nodeSubtext,children:["–¢–∏–ø: ",n.triggerType]})]}),a.jsx(F,{type:"source",position:U.Right,className:g.handle,style:{backgroundColor:n.color||"#3b82f6"}})]}),_a=({data:n,selected:e})=>a.jsxs("div",{className:`${g.customNode} ${g.actionNode} ${e?g.selected:""}`,children:[a.jsx(F,{type:"target",position:U.Left,className:g.handle,style:{backgroundColor:n.color||"#10b981"}}),a.jsxs("div",{className:g.nodeHeader,style:{backgroundColor:n.color||"#10b981"},children:[a.jsx("span",{className:g.nodeIcon,children:n.icon||"‚ö°"}),a.jsx("span",{className:g.nodeTitle,children:"–î–µ–π—Å—Ç–≤–∏–µ"})]}),a.jsxs("div",{className:g.nodeContent,children:[a.jsx("div",{className:g.nodeLabel,children:n.label}),n.actionType&&a.jsxs("div",{className:g.nodeSubtext,children:["–¢–∏–ø: ",n.actionType]})]}),a.jsx(F,{type:"source",position:U.Right,className:g.handle,style:{backgroundColor:n.color||"#10b981"}})]}),fa=({data:n,selected:e})=>a.jsxs("div",{className:`${g.customNode} ${g.conditionNode} ${e?g.selected:""}`,children:[a.jsx(F,{type:"target",position:U.Left,className:g.handle,style:{backgroundColor:n.color||"#f59e0b"}}),a.jsxs("div",{className:g.nodeHeader,style:{backgroundColor:n.color||"#f59e0b"},children:[a.jsx("span",{className:g.nodeIcon,children:n.icon||"‚ùì"}),a.jsx("span",{className:g.nodeTitle,children:"–£—Å–ª–æ–≤–∏–µ"})]}),a.jsxs("div",{className:g.nodeContent,children:[a.jsx("div",{className:g.nodeLabel,children:n.label}),n.conditionType&&a.jsxs("div",{className:g.nodeSubtext,children:["–¢–∏–ø: ",n.conditionType]})]}),a.jsxs("div",{className:g.conditionOutputs,children:[a.jsx(F,{type:"source",position:U.Right,id:"true",className:`${g.handle} ${g.trueHandle}`,style:{backgroundColor:"#10b981",top:"40%"}}),a.jsx(F,{type:"source",position:U.Right,id:"false",className:`${g.handle} ${g.falseHandle}`,style:{backgroundColor:"#ef4444",top:"60%"}})]}),a.jsxs("div",{className:g.outputLabels,children:[a.jsx("div",{className:g.outputLabel,style:{top:"35%"},children:"–î–∞"}),a.jsx("div",{className:g.outputLabel,style:{top:"55%"},children:"–ù–µ—Ç"})]})]}),ya={"trigger-message":pa,"action-send-message":_a,"condition-text":fa},Na=[{sourceType:"trigger-message",targetType:"action-send-message",allowed:!0},{sourceType:"trigger-message",targetType:"condition-text",allowed:!0},{sourceType:"condition-text",targetType:"action-send-message",allowed:!0},{sourceType:"condition-text",targetType:"condition-text",allowed:!0},{sourceType:"action-send-message",targetType:"action-send-message",allowed:!0},{sourceType:"action-send-message",targetType:"condition-text",allowed:!0},{sourceType:"action-send-message",targetType:"trigger-message",allowed:!1,reason:"–î–µ–π—Å—Ç–≤–∏—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"},{sourceType:"condition-text",targetType:"trigger-message",allowed:!1,reason:"–£—Å–ª–æ–≤–∏—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"}],va=(n,e)=>{const s=e.find(i=>i.id===n.source),t=e.find(i=>i.id===n.target);if(!s||!t)return{valid:!1,reason:"–£–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"};if(s.id===t.id)return{valid:!1,reason:"–£–∑–µ–ª –Ω–µ –º–æ–∂–µ—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å–∞–º —Å —Å–æ–±–æ–π"};const o=Na.find(i=>i.sourceType===s.type&&i.targetType===t.type);return o?{valid:o.allowed,reason:o.reason}:{valid:!1,reason:`–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É ${s.type} –∏ ${t.type} –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ`}};class Ca{errors=[];warnings=[];validationRules;constructor(){this.validationRules=this.initializeValidationRules()}initializeValidationRules(){return[{sourceCategory:"triggers",targetCategory:"conditions",allowed:!0},{sourceCategory:"triggers",targetCategory:"actions",allowed:!0},{sourceCategory:"triggers",targetCategory:"data",allowed:!0},{sourceCategory:"conditions",targetCategory:"actions",allowed:!0},{sourceCategory:"conditions",targetCategory:"data",allowed:!0},{sourceCategory:"conditions",targetCategory:"conditions",allowed:!0},{sourceCategory:"actions",targetCategory:"conditions",allowed:!0},{sourceCategory:"actions",targetCategory:"data",allowed:!0},{sourceCategory:"actions",targetCategory:"actions",allowed:!0},{sourceCategory:"actions",targetCategory:"integrations",allowed:!0},{sourceCategory:"data",targetCategory:"conditions",allowed:!0},{sourceCategory:"data",targetCategory:"actions",allowed:!0},{sourceCategory:"data",targetCategory:"integrations",allowed:!0},{sourceCategory:"integrations",targetCategory:"conditions",allowed:!0},{sourceCategory:"integrations",targetCategory:"actions",allowed:!0},{sourceCategory:"integrations",targetCategory:"data",allowed:!0},{sourceCategory:"actions",targetCategory:"triggers",allowed:!1,reason:"–î–µ–π—Å—Ç–≤–∏—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"},{sourceCategory:"conditions",targetCategory:"triggers",allowed:!1,reason:"–£—Å–ª–æ–≤–∏—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"},{sourceCategory:"data",targetCategory:"triggers",allowed:!1,reason:"–î–∞–Ω–Ω—ã–µ –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"},{sourceCategory:"integrations",targetCategory:"triggers",allowed:!1,reason:"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏"}]}validateSchema(e){return this.errors=[],this.warnings=[],e?(this.validateSchemaStructure(e),this.errors.length>0?this.getValidationResult():(this.validateNodes(e.nodes||[]),this.validateConnections(e.edges||[],e.nodes||[]),this.validateCyclicDependencies(e.nodes||[],e.edges||[]),this.validateLogicalIntegrity(e.nodes||[],e.edges||[]),this.validateNodeReachability(e.nodes||[],e.edges||[]),this.getValidationResult())):(this.addError("SCHEMA_MISSING","–°—Ö–µ–º–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏"),this.getValidationResult())}validateSchemaStructure(e){Array.isArray(e.nodes)||this.addError("INVALID_NODES_ARRAY","–ü–æ–ª–µ nodes –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),Array.isArray(e.edges)||this.addError("INVALID_EDGES_ARRAY","–ü–æ–ª–µ edges –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),e.nodes&&e.nodes.length===0&&this.addWarning("EMPTY_SCHEMA","–°—Ö–µ–º–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–∑–ª–æ–≤"),(!e.id||!e.name)&&this.addWarning("MISSING_SCHEMA_INFO","–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã")}validateNodes(e){const s=new Set;e.forEach((t,o)=>{const i=`—É–∑–µ–ª #${o+1}`;if(t.id||this.addError("MISSING_NODE_ID",`${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID —É–∑–ª–∞`,t.id),t.type||this.addError("MISSING_NODE_TYPE",`${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø —É–∑–ª–∞`,t.id),!t.data){this.addError("MISSING_NODE_DATA",`${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞`,t.id);return}const r=t.data;t.id&&(s.has(t.id)?this.addError("DUPLICATE_NODE_ID",`${i}: –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID —É–∑–ª–∞ "${t.id}"`,t.id):s.add(t.id)),r.category?["triggers","conditions","actions","data","integrations","scenarios"].includes(r.category)||this.addError("INVALID_CATEGORY",`${i}: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è "${r.category}"`,t.id):this.addError("MISSING_CATEGORY",`${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∑–ª–∞`,t.id),t.position?(typeof t.position.x!="number"||typeof t.position.y!="number")&&this.addError("INVALID_POSITION",`${i}: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —É–∑–ª–∞`,t.id):this.addWarning("MISSING_POSITION",`${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–∑–∏—Ü–∏—è —É–∑–ª–∞`,t.id),this.validateNodeConfig(r,i,t.id)})}validateNodeConfig(e,s,t){if(!e.config){this.addWarning("MISSING_NODE_CONFIG",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∑–ª–∞`,t);return}switch(e.category){case"triggers":this.validateTriggerNode(e,s,t);break;case"conditions":this.validateConditionNode(e,s,t);break;case"actions":this.validateActionNode(e,s,t);break;case"data":this.validateDataNode(e,s,t);break;case"integrations":this.validateIntegrationNode(e,s,t);break}}validateTriggerNode(e,s,t){const o=e.config;o.triggerType||this.addError("MISSING_TRIGGER_TYPE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞`,t),o.triggerType==="command"&&!o.command&&this.addError("MISSING_COMMAND",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã`,t),o.triggerType==="message"&&!o.pattern&&!o.keywords&&this.addWarning("MISSING_MESSAGE_PATTERN",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è`,t)}validateConditionNode(e,s,t){const o=e.config;o.conditionType||this.addError("MISSING_CONDITION_TYPE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø —É—Å–ª–æ–≤–∏—è`,t),o.conditionType==="text_contains"&&!o.text&&this.addError("MISSING_CONDITION_TEXT",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è`,t),o.conditionType==="user_role"&&!o.role&&this.addError("MISSING_USER_ROLE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏`,t)}validateActionNode(e,s,t){const o=e.config;o.actionType||this.addError("MISSING_ACTION_TYPE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è`,t),o.actionType==="send_message"&&!o.message&&this.addWarning("EMPTY_MESSAGE",`${s}: –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏`,t),o.actionType==="send_photo"&&!o.photo&&this.addError("MISSING_PHOTO",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏`,t),o.actionType==="ban_user"&&!o.duration&&this.addWarning("MISSING_BAN_DURATION",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–Ω–∞`,t)}validateDataNode(e,s,t){const o=e.config;o.dataType||this.addError("MISSING_DATA_TYPE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö`,t),o.dataType==="variable"&&!o.variableName&&this.addError("MISSING_VARIABLE_NAME",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π`,t),o.dataType==="counter"&&typeof o.initialValue!="number"&&this.addWarning("MISSING_INITIAL_VALUE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞`,t)}validateIntegrationNode(e,s,t){const o=e.config;o.integrationType||this.addError("MISSING_INTEGRATION_TYPE",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`,t),o.integrationType==="http"&&!o.url&&this.addError("MISSING_HTTP_URL",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL –¥–ª—è HTTP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`,t),o.integrationType==="webhook"&&!o.webhookUrl&&this.addError("MISSING_WEBHOOK_URL",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL webhook'–∞`,t),o.integrationType==="database"&&!o.connectionString&&this.addError("MISSING_DB_CONNECTION",`${s}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`,t)}validateConnections(e,s){const t=new Map(s.map(i=>[i.id,i])),o=new Set;e.forEach((i,r)=>{const c=`—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ #${r+1}`;i.id||this.addError("MISSING_EDGE_ID",`${c}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è`),i.source||this.addError("MISSING_SOURCE_NODE",`${c}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª`),i.target||this.addError("MISSING_TARGET_NODE",`${c}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª`),i.id&&(o.has(i.id)?this.addError("DUPLICATE_EDGE_ID",`${c}: –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è "${i.id}"`,void 0,i.id):o.add(i.id));const l=t.get(i.source),_=t.get(i.target);l||this.addError("SOURCE_NODE_NOT_FOUND",`${c}: –∏—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª "${i.source}" –Ω–µ –Ω–∞–π–¥–µ–Ω`,void 0,i.id),_||this.addError("TARGET_NODE_NOT_FOUND",`${c}: —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª "${i.target}" –Ω–µ –Ω–∞–π–¥–µ–Ω`,void 0,i.id),l&&_&&this.validateConnectionRules(l,_,c,i.id),i.source===i.target&&this.addWarning("SELF_CONNECTION",`${c}: —É–∑–µ–ª —Å–æ–µ–¥–∏–Ω–µ–Ω —Å–∞–º —Å —Å–æ–±–æ–π`,i.source,i.id)})}validateConnectionRules(e,s,t,o){const i=e.data,r=s.data;if(!i?.category||!r?.category)return;const c=this.validationRules.find(l=>l.sourceCategory===i.category&&l.targetCategory===r.category);c?c.allowed||this.addError("FORBIDDEN_CONNECTION",`${t}: ${c.reason||"–ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"}`,void 0,o):this.addWarning("UNDEFINED_CONNECTION",`${t}: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É "${i.category}" –∏ "${r.category}" –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ`,void 0,o)}validateCyclicDependencies(e,s){const t=this.buildGraph(e,s),o=new Set,i=new Set;for(const r of t.keys())if(!o.has(r)){const c=this.detectCycle(t,r,o,i,[]);c.length>0&&this.addError("CYCLIC_DEPENDENCY",`–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: ${c.join(" ‚Üí ")}`,r)}}buildGraph(e,s){const t=new Map;return e.forEach(o=>{t.set(o.id,[])}),s.forEach(o=>{t.has(o.source)&&t.get(o.source).push(o.target)}),t}detectCycle(e,s,t,o,i){t.add(s),o.add(s),i.push(s);const r=e.get(s)||[];for(const c of r)if(t.has(c)){if(o.has(c)){const l=i.indexOf(c);return[...i.slice(l),c]}}else{const l=this.detectCycle(e,c,t,o,[...i]);if(l.length>0)return l}return o.delete(s),[]}validateLogicalIntegrity(e,s){const t=e.filter(i=>i.data?.category==="triggers");t.length===0&&this.addWarning("NO_TRIGGERS","–°—Ö–µ–º–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ - –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è"),e.filter(i=>i.data?.category==="actions").length===0&&this.addWarning("NO_ACTIONS","–°—Ö–µ–º–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π - –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"),this.validateIsolatedNodes(e,s),this.validateDuplicateTriggers(t)}validateIsolatedNodes(e,s){const t=new Set;s.forEach(o=>{t.add(o.source),t.add(o.target)}),e.forEach(o=>{t.has(o.id)||this.addWarning("ISOLATED_NODE",`–£–∑–µ–ª "${o.id}" –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–≥–∏–∫–µ –±–æ—Ç–∞`,o.id)})}validateDuplicateTriggers(e){const s=new Map;e.forEach(t=>{const i=t.data.config?.triggerType;i&&(s.has(i)||s.set(i,[]),s.get(i).push(t))}),s.forEach((t,o)=>{if(t.length>1){const i=t.map(r=>r.id).join(", ");this.addWarning("DUPLICATE_TRIGGERS",`–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ —Ç–∏–ø–∞ "${o}": ${i}`)}})}validateNodeReachability(e,s){const t=e.filter(r=>r.data?.category==="triggers");if(t.length===0)return;const o=this.buildGraph(e,s),i=new Set;t.forEach(r=>{this.dfsReachability(o,r.id,i)}),e.forEach(r=>{r.data?.category!=="triggers"&&!i.has(r.id)&&this.addWarning("UNREACHABLE_NODE",`–£–∑–µ–ª "${r.id}" –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º –æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤`,r.id)})}dfsReachability(e,s,t){if(t.has(s))return;t.add(s),(e.get(s)||[]).forEach(i=>{this.dfsReachability(e,i,t)})}quickValidate(e){return this.errors=[],this.warnings=[],!e?.nodes||!e?.edges?(this.addError("INVALID_SCHEMA_STRUCTURE","–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ö–µ–º—ã"),this.getValidationResult()):(this.validateNodes(e.nodes),this.validateConnections(e.edges,e.nodes),this.getValidationResult())}validateSingleNode(e){return this.errors=[],this.warnings=[],e?(this.validateNodes([e]),this.getValidationResult()):(this.addError("NODE_MISSING","–£–∑–µ–ª –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏"),this.getValidationResult())}validateSingleConnection(e,s){return this.errors=[],this.warnings=[],e?(this.validateConnections([e],s),this.getValidationResult()):(this.addError("CONNECTION_MISSING","–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏"),this.getValidationResult())}getCompatibleNodeTypes(e){return this.validationRules.filter(s=>s.sourceCategory===e&&s.allowed).map(s=>s.targetCategory)}canConnect(e,s){const t=e.data,o=s.data;if(!t?.category||!o?.category)return{canConnect:!1,reason:"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∑–ª–∞"};if(e.id===s.id)return{canConnect:!1,reason:"–£–∑–µ–ª –Ω–µ –º–æ–∂–µ—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è —Å–∞–º —Å —Å–æ–±–æ–π"};const i=this.validationRules.find(r=>r.sourceCategory===t.category&&r.targetCategory===o.category);return i?{canConnect:i.allowed,reason:i.reason}:{canConnect:!1,reason:`–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É ${t.category} –∏ ${o.category} –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ`}}addError(e,s,t,o){this.errors.push({type:e,message:s,severity:"error",nodeId:t,connectionId:o})}addWarning(e,s,t,o){this.warnings.push({type:e,message:s,severity:"warning",nodeId:t,connectionId:o})}getValidationResult(){return{isValid:this.errors.length===0,hasWarnings:this.warnings.length>0,errors:this.errors,warnings:this.warnings,summary:{errorCount:this.errors.length,warningCount:this.warnings.length,totalIssues:this.errors.length+this.warnings.length}}}}const ge=new Ca,ba="Editor-module__editor___Dib1d",Ea="Editor-module__header___ixuS1",xa="Editor-module__headerLeft___Lq95c",Ia="Editor-module__backButton___ArVga",wa="Editor-module__headerRight___ZCo4y",Sa="Editor-module__saveButton___cR55-",Ta="Editor-module__editorContent___2ZAh3",ja="Editor-module__flowContainer___5IR9D",O={editor:ba,header:Ea,headerLeft:xa,backButton:Ia,headerRight:wa,saveButton:Sa,editorContent:Ta,flowContainer:ja},$a=[{id:"1",type:"trigger-message",data:{label:"–°–æ–æ–±—â–µ–Ω–∏–µ",triggerType:"text",icon:"üì®",color:"#3b82f6"},position:{x:100,y:100}}],Da=[],Ma=()=>{const{botId:n}=Le(),{state:e,fetchBot:s,saveBot:t}=Pe(),[o,i,r]=Ae($a),[c,l,_]=ke(Da),[N,w]=y.useState(null),[C,f]=y.useState({errors:[],warnings:[]}),x=y.useRef(null),[v,j]=y.useState(null);d.useEffect(()=>{n&&s(n)},[n,s]),d.useEffect(()=>{e.currentBot?.configuration&&(e.currentBot.configuration.nodes&&i(e.currentBot.configuration.nodes),e.currentBot.configuration.edges&&l(e.currentBot.configuration.edges))},[e.currentBot,i,l]);const b=y.useCallback(()=>{const m={id:n||"temp",name:e.currentBot?.name||"–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞",description:e.currentBot?.description||"",nodes:o,edges:c,variables:{},settings:{}},p=ge.validateSchema(m);f({errors:p.errors,warnings:p.warnings})},[o,c,n,e.currentBot]);d.useEffect(()=>{(o.length>0||c.length>0)&&b()},[o,c,b]);const S=y.useCallback(m=>{const p=va(m,o);p.valid?l(E=>Oe(m,E)):alert(`–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ${p.reason}`)},[l,o]),L=y.useCallback((m,p)=>{w(p)},[]),$=y.useCallback(()=>{w(null)},[]),B=y.useCallback(m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},[]),D=y.useCallback(m=>{m.preventDefault();const p=x.current?.getBoundingClientRect(),E=m.dataTransfer.getData("application/reactflow");if(typeof E>"u"||!E||!p)return;const h=v?.project({x:m.clientX-p.left,y:m.clientY-p.top}),P={id:`${E}-${Date.now()}`,type:E,position:h,data:R(E)};i(V=>V.concat(P))},[v,i]),R=m=>{switch(m){case"trigger-message":return{label:"–°–æ–æ–±—â–µ–Ω–∏–µ",triggerType:"text",icon:"üì®",color:"#3b82f6"};case"action-send-message":return{label:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",actionType:"send",icon:"üí¨",color:"#10b981",message:"–ü—Ä–∏–≤–µ—Ç!"};case"condition-text":return{label:"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞",conditionType:"contains",icon:"üîç",color:"#f59e0b",condition:"—Å–æ–¥–µ—Ä–∂–∏—Ç",value:""};default:return{label:"–£–∑–µ–ª"}}},q=async()=>{const m={id:n||"temp",name:e.currentBot?.name||(n?"–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–æ—Ç":"–ù–æ–≤—ã–π –±–æ—Ç"),description:e.currentBot?.description||"–°–æ–∑–¥–∞–Ω –≤ –≤–∏–∑—É–∞–ª—å–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ",nodes:o,edges:c,variables:e.currentBot?.configuration?.variables||{},settings:e.currentBot?.configuration?.settings||{}},p=ge.validateSchema(m);if(!p.isValid){const h=p.errors.map(P=>`‚Ä¢ ${P.message}`).join(`
`);alert(`–û—à–∏–±–∫–∏ –≤ —Å—Ö–µ–º–µ:
${h}`);return}if(p.hasWarnings){const h=p.warnings.map(V=>`‚Ä¢ ${V.message}`).join(`
`);if(!confirm(`–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ:
${h}

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ?`))return}const E={id:n,name:m.name,description:m.description,status:e.currentBot?.status||"draft",configuration:{nodes:o.map(h=>({id:h.id,type:h.type,position:h.position,data:h.data})),edges:c.map(h=>({id:h.id,source:h.source,target:h.target,sourceHandle:h.sourceHandle,targetHandle:h.targetHandle})),variables:m.variables,settings:m.settings}};try{await t(E),alert("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!")}catch(h){console.error("Error saving bot:",h),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–æ—Ç–∞")}};return a.jsxs("div",{className:O.editor,children:[a.jsxs("header",{className:O.header,children:[a.jsxs("div",{className:O.headerLeft,children:[a.jsx(Be,{to:"/",className:O.backButton,children:"‚Üê –ù–∞–∑–∞–¥"}),a.jsx("h1",{children:n?"–†–µ–¥–∞–∫—Ç–æ—Ä –±–æ—Ç–∞":"–ù–æ–≤—ã–π –±–æ—Ç"})]}),a.jsx("div",{className:O.headerRight,children:a.jsx("button",{onClick:q,className:O.saveButton,disabled:e.loading,children:e.loading?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})})]}),a.jsxs("div",{className:O.editorContent,children:[a.jsx(wt,{onNodeAdd:m=>{const p={id:`${m}-${Date.now()}`,type:m,position:{x:Math.random()*400+100,y:Math.random()*400+100},data:R(m)};i(E=>E.concat(p))}}),a.jsx("div",{className:O.flowContainer,ref:x,children:a.jsxs(He,{nodes:o,edges:c,onNodesChange:r,onEdgesChange:_,onConnect:S,onNodeClick:L,onPaneClick:$,onInit:j,onDrop:D,onDragOver:B,nodeTypes:ya,fitView:!0,children:[a.jsx(ot,{}),a.jsx(Xe,{}),a.jsx(ct,{variant:T.Dots,gap:12,size:1})]})}),a.jsx(Gt,{selectedNode:N,onNodeUpdate:(m,p)=>{i(E=>E.map(h=>h.id===m?{...h,data:{...h.data,...p}}:h))}}),a.jsx(Jt,{errors:C.errors,warnings:C.warnings})]})]})};export{Ma as default};
